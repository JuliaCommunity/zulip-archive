[
    {
        "content": "<p>From the <a href=\"https://docs.julialang.org/en/v1/manual/missing/#Arrays-With-Missing-Values\">docs</a> my understanding is that <code>Array</code>s of optionally <code>missing</code> values actually store two arrays, one for the data and one to store whether or not the value is <code>missing</code>. If I've got that right, I don't understand why <code>sizeof()</code> says these are the same size in memory:</p>\n<div class=\"codehilite\" data-code-language=\"Julia console\"><pre><span></span><code><span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">rand</span><span class=\"p\">(</span><span class=\"kt\">UInt16</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"go\">2×2 Matrix{UInt16}:</span>\n<span class=\"go\"> 61892   4489</span>\n<span class=\"go\"> 19311  27433</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kt\">Array</span><span class=\"p\">{</span><span class=\"kt\">Union</span><span class=\"p\">{</span><span class=\"kt\">Missing</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">UInt16</span><span class=\"p\">}}(</span><span class=\"nb\">missing</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"go\">2×2 Matrix{Union{Missing, UInt16}}:</span>\n<span class=\"go\"> missing  missing</span>\n<span class=\"go\"> missing  missing</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">sizeof</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"go\">8</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">sizeof</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"go\">8</span>\n</code></pre></div>\n<p>Shouldn't <code>sizeof(y) == 12</code>? 8 bytes for the data plus 4 bytes for the mask.</p>",
        "id": 292017656,
        "sender_full_name": "James Wrigley",
        "timestamp": 1659624459
    },
    {
        "content": "<p>Ah hah, turns out I should be using <code>Base.summarysize()</code>: <a href=\"https://discourse.julialang.org/t/sizeof-vector-union-missing-t-and-hypothetical-size/15271/14\">https://discourse.julialang.org/t/sizeof-vector-union-missing-t-and-hypothetical-size/15271/14</a></p>\n<div class=\"codehilite\" data-code-language=\"Julia console\"><pre><span></span><code><span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Base</span><span class=\"o\">.</span><span class=\"n\">summarysize</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"go\">48</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Base</span><span class=\"o\">.</span><span class=\"n\">summarysize</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"go\">52</span>\n</code></pre></div>",
        "id": 292018508,
        "sender_full_name": "James Wrigley",
        "timestamp": 1659624790
    }
]