[
    {
        "content": "<p>I'm looking to drop the user into a \"prototyping\" REPL where they can do a few things and then the result is saved in a script. I'd like to create a new temporary namespace for this and then drop back to old-Main later. From <a href=\"https://github.com/JuliaLang/julia/issues/2385#issuecomment-1261400850\">https://github.com/JuliaLang/julia/issues/2385#issuecomment-1261400850</a> I get the impression this might be possible, but I have no idea how.</p>",
        "id": 311218377,
        "sender_full_name": "Timothy",
        "timestamp": 1669008778
    },
    {
        "content": "<p>In version 1.9, you can do</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">REPL</span><span class=\"w\"></span>\n<span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">activate</span><span class=\"p\">(</span><span class=\"o\">::</span><span class=\"kt\">Module</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 311219104,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669009474
    },
    {
        "content": "<p><a href=\"https://github.com/JuliaLang/julia/blob/master/stdlib/REPL/docs/src/index.md#changing-the-contextual-module-which-is-active-at-the-repl\">https://github.com/JuliaLang/julia/blob/master/stdlib/REPL/docs/src/index.md#changing-the-contextual-module-which-is-active-at-the-repl</a></p>",
        "id": 311219125,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669009504
    },
    {
        "content": "<p>But that won't help you with the \"save input to a script\" part</p>",
        "id": 311219133,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669009518
    },
    {
        "content": "<p>Well, I guess you could save the REPL history from the logs</p>",
        "id": 311219243,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669009634
    },
    {
        "content": "<p>Here's how I'd approach it:</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">ReplMaker</span><span class=\"w\"></span>\n\n<span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">script_mode</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"o\">=</span><span class=\"p\">(</span><span class=\"nd\">@eval</span><span class=\"w\"> </span><span class=\"k\">module</span><span class=\"w\"> </span><span class=\"o\">$</span><span class=\"p\">(</span><span class=\"n\">gensym</span><span class=\"p\">(</span><span class=\"ss\">:Scratch</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">end</span><span class=\"p\">))</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">initrepl</span><span class=\"p\">(;</span><span class=\"n\">prompt_text</span><span class=\"o\">=</span><span class=\"s\">\"Script&gt; \"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">start_key</span><span class=\"o\">=</span><span class=\"sc\">')'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mode_name</span><span class=\"o\">=</span><span class=\"s\">\"Script mode\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">valid_input_checker</span><span class=\"o\">=</span><span class=\"n\">complete_julia</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">ex</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Meta</span><span class=\"o\">.</span><span class=\"n\">parse</span><span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">ex</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"ss\">:block</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">ex</span><span class=\"o\">.</span><span class=\"n\">head</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"ss\">:toplevel</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">open</span><span class=\"p\">(</span><span class=\"n\">filename</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"a+\"</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"n\">io</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">write</span><span class=\"p\">(</span><span class=\"n\">io</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"o\">*</span><span class=\"s\">\"</span><span class=\"se\">\\n\\n</span><span class=\"s\">\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"o\">:</span><span class=\"p\">(</span><span class=\"nd\">@eval</span><span class=\"w\"> </span><span class=\"o\">$</span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"o\">$</span><span class=\"n\">ex</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nb\">nothing</span><span class=\"w\"></span>\n<span class=\"k\">end</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 311220626,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669010724
    },
    {
        "content": "<p>Now at the REPL,</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"n\">julia</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">script_mode</span><span class=\"p\">(</span><span class=\"s\">\"my_script.jl\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">REPL</span><span class=\"w\"> </span><span class=\"n\">mode</span><span class=\"w\"> </span><span class=\"n\">Script</span><span class=\"w\"> </span><span class=\"n\">mode</span><span class=\"w\"> </span><span class=\"n\">initialized</span><span class=\"o\">.</span><span class=\"w\"> </span><span class=\"n\">Press</span><span class=\"w\"> </span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">enter</span><span class=\"w\"> </span><span class=\"n\">and</span><span class=\"w\"> </span><span class=\"n\">backspace</span><span class=\"w\"> </span><span class=\"n\">to</span><span class=\"w\"> </span><span class=\"n\">exit</span><span class=\"o\">.</span><span class=\"w\"></span>\n\n<span class=\"n\">Script</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"mi\">1</span><span class=\"w\"></span>\n\n<span class=\"n\">Script</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"></span>\n<span class=\"mi\">2</span><span class=\"w\"></span>\n\n<span class=\"n\">Script</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"></span>\n<span class=\"mi\">3</span><span class=\"w\"></span>\n\n<span class=\"n\">Script</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"n\">f</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">generic</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">with</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"> </span><span class=\"n\">method</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>\n<p>And here's the generated script:</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"n\">shell</span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"n\">cat</span><span class=\"w\"> </span><span class=\"n\">my_script</span><span class=\"o\">.</span><span class=\"n\">jl</span><span class=\"w\"></span>\n<span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n\n<span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">2</span><span class=\"w\"></span>\n\n<span class=\"n\">z</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"></span>\n\n<span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"k\">end</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 311220765,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669010838
    },
    {
        "content": "<p>And everything is properly namespaced, so the <code>Main</code> repl isn't polluted:</p>\n<div class=\"codehilite\" data-code-language=\"Julia console\"><pre><span></span><code><span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"w\"></span>\n<span class=\"gr\">ERROR: UndefVarError: x not defined</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"></span>\n<span class=\"gr\">ERROR: UndefVarError: y not defined</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">z</span><span class=\"w\"></span>\n<span class=\"gr\">ERROR: UndefVarError: z not defined</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">f</span><span class=\"w\"></span>\n<span class=\"gr\">ERROR: UndefVarError: f not defined</span>\n</code></pre></div>",
        "id": 311221075,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669011071
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"269150\">Mason Protter</span> <a href=\"#narrow/stream/274208-helpdesk-.28published.29/topic/Temporary.20namespace/near/311220626\">said</a>:</p>\n<blockquote>\n<p>Here's how I'd approach it:</p>\n<p><div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">ReplMaker</span><span class=\"w\"></span>\n\n<span class=\"o\">...</span><span class=\"w\"></span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>There should be a github of just useful scripts like this</p>",
        "id": 311221327,
        "sender_full_name": "Syx Pek",
        "timestamp": 1669011257
    },
    {
        "content": "<p>Thanks Mason, I'll have a look at <code>REPL.activate</code>.</p>\n<p>For reference, this is what I've got so far</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"n\">subrepl</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">LineEditREPL</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">terminal</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                            </span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"nb\">stdout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">:color</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">))</span><span class=\"w\"></span>\n<span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">subrepl</span><span class=\"o\">.</span><span class=\"n\">hascolor</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">subrepl</span><span class=\"o\">.</span><span class=\"n\">prompt_color</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">Base</span><span class=\"o\">.</span><span class=\"n\">text_colors</span><span class=\"p\">[</span><span class=\"ss\">:light_magenta</span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"n\">subrepl</span><span class=\"o\">.</span><span class=\"n\">interface</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">setup_interface</span><span class=\"p\">(</span><span class=\"n\">subrepl</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"p\">(;</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">first</span><span class=\"p\">(</span><span class=\"n\">subrepl</span><span class=\"o\">.</span><span class=\"n\">interface</span><span class=\"o\">.</span><span class=\"n\">modes</span><span class=\"p\">[</span><span class=\"k\">isa</span><span class=\"o\">.</span><span class=\"p\">(</span><span class=\"n\">subrepl</span><span class=\"o\">.</span><span class=\"n\">interface</span><span class=\"o\">.</span><span class=\"n\">modes</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">LineEdit</span><span class=\"o\">.</span><span class=\"n\">HistoryPrompt</span><span class=\"p\">)])</span><span class=\"w\"></span>\n<span class=\"n\">hp</span><span class=\"o\">.</span><span class=\"n\">mode_mapping</span><span class=\"p\">[</span><span class=\"ss\">:julia</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">prompt</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"(data) julia&gt; \"</span><span class=\"w\"></span>\n<span class=\"n\">hp</span><span class=\"o\">.</span><span class=\"n\">mode_mapping</span><span class=\"p\">[</span><span class=\"ss\">:shell</span><span class=\"p\">]</span><span class=\"o\">.</span><span class=\"n\">prompt</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"(data) shell&gt; \"</span><span class=\"w\"></span>\n<span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">run_repl</span><span class=\"p\">(</span><span class=\"n\">subrepl</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"n\">lines</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">map</span><span class=\"p\">(</span><span class=\"n\">zip</span><span class=\"p\">(</span><span class=\"n\">hp</span><span class=\"o\">.</span><span class=\"n\">history</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">hp</span><span class=\"o\">.</span><span class=\"n\">modes</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">do</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">line</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">mode</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">mode</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"ss\">:julia</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">line</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"c\"># Identify data\"\"-y commands and extract to variables</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">mode</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"ss\">:shell</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"s\">\"run(`</span><span class=\"si\">$line</span><span class=\"s\">`)\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">mode</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"ss\">:help</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nb\">nothing</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">else</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nd\">@warn</span><span class=\"w\"> </span><span class=\"s\">\"Mode </span><span class=\"si\">$mode</span><span class=\"s\"> unrecognised\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nb\">nothing</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"n\">content</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">string</span><span class=\"p\">(</span><span class=\"s\">\"# Formed by wrangle command</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"s\">\"function ()</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"n\">join</span><span class=\"p\">(</span><span class=\"n\">filter</span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">isnothing</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">lines</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">  \"</span><span class=\"p\">),</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"s\">\"</span><span class=\"se\">\\n</span><span class=\"s\">end\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 311221743,
        "sender_full_name": "Timothy",
        "timestamp": 1669011616
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"284969\">Syx Pek</span> <a href=\"#narrow/stream/274208-helpdesk-.28published.29/topic/Temporary.20namespace/near/311221327\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"269150\">Mason Protter</span> <a href=\"#narrow/stream/274208-helpdesk-.28published.29/topic/Temporary.20namespace/near/311220626\">said</a>:</p>\n<blockquote>\n<p>Here's how I'd approach it:</p>\n<p><div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">ReplMaker</span><span class=\"w\"></span>\n\n<span class=\"o\">...</span><span class=\"w\"></span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p>There should be a github of just useful scripts like this</p>\n</blockquote>\n<p>There's the <a href=\"https://github.com/search?q=ReplMaker.jl&amp;type=Repositories\">ReplMaker.jl</a> readme <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 311222005,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669011835
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"400021\">@Timothy</span> does the <a href=\"https://github.com/search?q=ReplMaker.jl&amp;type=Repositories\">ReplMaker.jl</a> thing I posted not work for you?</p>",
        "id": 311222060,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669011856
    },
    {
        "content": "<p>I won't be ably to try until later, I just thought I'd share what I started with.</p>",
        "id": 311222094,
        "sender_full_name": "Timothy",
        "timestamp": 1669011898
    },
    {
        "content": "<p>That said, I do generally try to avoid dependencies so if I can make do without it I'll probably try that, but I expect it will be useful regardless :)</p>",
        "id": 311222210,
        "sender_full_name": "Timothy",
        "timestamp": 1669011987
    },
    {
        "content": "<p>I find the REPL code in base really hard to use, and easy to get broken with version changes, so that's why I try to push ReplMaker.</p>",
        "id": 311222671,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669012345
    },
    {
        "content": "<p>But yeah, if you can figure out how to do it without ReplMaker then that's nice. Be warned though, it might mean you know enough about the REPL internals that I'll come ask for you help next time a julia update breaks <a href=\"https://github.com/search?q=ReplMaker.jl&amp;type=Repositories\">ReplMaker.jl</a> <span aria-label=\"laughing\" class=\"emoji emoji-1f606\" role=\"img\" title=\"laughing\">:laughing:</span></p>",
        "id": 311222783,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669012434
    },
    {
        "content": "<p>That sounds reasonable. If I wasn't \"almost there\" with my non-ReplMaker approach I'd probably jump on that (I've already got a bunch of other stuff sorted).</p>",
        "id": 311222833,
        "sender_full_name": "Timothy",
        "timestamp": 1669012460
    },
    {
        "content": "<p>At this point I've got enough \"nice things\" on top of <code>REPL</code> (e.g. sub-commands with automatic  help and completion), that the little bit of extra here is very likely less effort than rewriting to use <code>ReplMaker</code>.</p>",
        "id": 311222891,
        "sender_full_name": "Timothy",
        "timestamp": 1669012558
    },
    {
        "content": "<p>Throwaway comment: I wish the Julia <code>REPL</code> module came with a nice little library of interactive terminal utils (e.g. a better version of <code>print(\"Question? \"); readline(stdin)</code> for prompting the user, y/n confirmation, etc.)</p>",
        "id": 311223039,
        "sender_full_name": "Timothy",
        "timestamp": 1669012652
    },
    {
        "content": "<p>Since the REPL experience with Julia is rather important, making it easy for packages to make nice REPL experiences seems like it would be well worth the ~1-200 lines for a few nice extras.</p>",
        "id": 311223154,
        "sender_full_name": "Timothy",
        "timestamp": 1669012709
    },
    {
        "content": "<p>yeah</p>",
        "id": 311223274,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669012782
    },
    {
        "content": "<p>I want <a href=\"https://github.com/search?q=ReplMaker.jl&amp;type=Repositories\">ReplMaker.jl</a> to try and provide a good toolkit since <a href=\"https://github.com/search?q=REPL.jl&amp;type=Repositories\">REPL.jl</a> itself refuses to, but it's hard.</p>",
        "id": 311223441,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669012867
    },
    {
        "content": "<p>As it is I have some hacky hand-rolled stand-ins, e.g.</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"s\">\"\"\"</span>\n<span class=\"s\">    prompt(question::AbstractString, default::AbstractString=\"\",</span>\n<span class=\"s\">           allowempty::Bool=false, cleardefault::Bool=true)</span>\n<span class=\"s\">Interactively ask `question` and return the response string, optionally</span>\n<span class=\"s\">with a `default` value.</span>\n\n<span class=\"s\">Unless `allowempty` is set an empty response is not accepted.</span>\n<span class=\"s\">If `cleardefault` is set, then an initial backspace will clear the default value.</span>\n\n<span class=\"s\">The prompt supports the following line-edit-y keys:</span>\n<span class=\"s\">- left arrow</span>\n<span class=\"s\">- right arrow</span>\n<span class=\"s\">- home</span>\n<span class=\"s\">- end</span>\n<span class=\"s\">- delete forwards</span>\n<span class=\"s\">- delete backwards</span>\n\n<span class=\"s\">### Example</span>\n\n<span class=\"s\">```julia-repl</span>\n<span class=\"s\">julia&gt; prompt(\"What colour is the sky? \")</span>\n<span class=\"s\">What colour is the sky? Blue</span>\n<span class=\"s\">\"Blue\"</span>\n<span class=\"s\">```</span>\n<span class=\"s\">\"\"\"</span><span class=\"w\"></span>\n<span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">prompt</span><span class=\"p\">(</span><span class=\"n\">question</span><span class=\"o\">::</span><span class=\"kt\">AbstractString</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"o\">::</span><span class=\"kt\">AbstractString</span><span class=\"o\">=</span><span class=\"s\">\"\"</span><span class=\"p\">;</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">allowempty</span><span class=\"o\">::</span><span class=\"kt\">Bool</span><span class=\"o\">=</span><span class=\"nb\">false</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">cleardefault</span><span class=\"o\">::</span><span class=\"kt\">Bool</span><span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">printstyled</span><span class=\"p\">(</span><span class=\"n\">question</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"o\">=</span><span class=\"n\">REPL_QUESTION_COLOR</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"nb\">stdout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">:color</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"n\">Base</span><span class=\"o\">.</span><span class=\"n\">text_colors</span><span class=\"p\">[</span><span class=\"n\">REPL_USER_INPUT_COLOUR</span><span class=\"p\">])</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">Terminals</span><span class=\"o\">.</span><span class=\"n\">raw!</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">terminal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">response</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">response</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">collect</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">firstinput</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"\\e[s\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"\\e[u\\e[J\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"kt\">String</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"\\e[90m\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"kt\">String</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">))</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"\\e[</span><span class=\"si\">$</span><span class=\"p\">(</span><span class=\"n\">length</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"p\">)</span><span class=\"s\">D\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kt\">Char</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">readkey</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">terminal</span><span class=\"o\">.</span><span class=\"n\">in_stream</span><span class=\"p\">))</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'\\r'</span><span class=\"w\">  </span><span class=\"c\"># RET</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">isempty</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">||</span><span class=\"w\"> </span><span class=\"n\">allowempty</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"sc\">'\\n'</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"k\">break</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'Ϭ'</span><span class=\"w\"> </span><span class=\"c\"># DEL-forward</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">&lt;</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"n\">deleteat!</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'\\x03'</span><span class=\"w\"> </span><span class=\"c\"># ^C</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"\\e[m^C</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">throw</span><span class=\"p\">(</span><span class=\"kt\">InterruptException</span><span class=\"p\">())</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'\\x7f'</span><span class=\"w\"> </span><span class=\"c\"># DEL</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">firstinput</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">cleardefault</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"n\">response</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"kt\">Char</span><span class=\"p\">[]</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">&gt;</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"n\">deleteat!</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">                    </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">-=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'Ϩ'</span><span class=\"w\"> </span><span class=\"c\"># &lt;left&gt;</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">max</span><span class=\"p\">(</span><span class=\"mi\">0</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">-</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'ϩ'</span><span class=\"w\"> </span><span class=\"c\"># &lt;right&gt;</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">min</span><span class=\"p\">(</span><span class=\"n\">length</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">),</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'ϭ'</span><span class=\"w\"> </span><span class=\"c\"># HOME</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"mi\">0</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'Ϯ'</span><span class=\"w\"> </span><span class=\"c\"># END</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">length</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">else</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">point</span><span class=\"w\"> </span><span class=\"o\">+=</span><span class=\"w\"> </span><span class=\"mi\">1</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"n\">insert!</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">point</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">next</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">firstinput</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"kt\">String</span><span class=\"p\">(</span><span class=\"n\">response</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">Terminals</span><span class=\"o\">.</span><span class=\"n\">raw!</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">terminal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"nb\">stdout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">:color</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"\\e[m\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">response</span><span class=\"w\"></span>\n<span class=\"k\">end</span><span class=\"w\"></span>\n\n<span class=\"s\">\"\"\"</span>\n<span class=\"s\">    prompt_char(question::AbstractString, options::Vector{Char},</span>\n<span class=\"s\">                default::Union{Char, Nothing}=nothing)</span>\n<span class=\"s\">Interatively ask `question`, only accepting `options` keys as answers.</span>\n<span class=\"s\">All keys are converted to lower case on input. If `default` is not nothing and</span>\n<span class=\"s\">'RET' is hit, then `default` will be returned.</span>\n\n<span class=\"s\">Should '^C' be pressed, an InterruptException will be thrown.</span>\n<span class=\"s\">\"\"\"</span><span class=\"w\"></span>\n<span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">prompt_char</span><span class=\"p\">(</span><span class=\"n\">question</span><span class=\"o\">::</span><span class=\"kt\">AbstractString</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">options</span><span class=\"o\">::</span><span class=\"kt\">Vector</span><span class=\"p\">{</span><span class=\"kt\">Char</span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">                     </span><span class=\"n\">default</span><span class=\"o\">::</span><span class=\"kt\">Union</span><span class=\"p\">{</span><span class=\"kt\">Char</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">Nothing</span><span class=\"p\">}</span><span class=\"o\">=</span><span class=\"nb\">nothing</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">printstyled</span><span class=\"p\">(</span><span class=\"n\">question</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">color</span><span class=\"o\">=</span><span class=\"n\">REPL_QUESTION_COLOR</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">Terminals</span><span class=\"o\">.</span><span class=\"n\">raw!</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">terminal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">true</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">char</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"sc\">'\\x01'</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">while</span><span class=\"w\"> </span><span class=\"n\">char</span><span class=\"w\"> </span><span class=\"o\">∉</span><span class=\"w\"> </span><span class=\"n\">options</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"n\">char</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">lowercase</span><span class=\"p\">(</span><span class=\"kt\">Char</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">readkey</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">terminal</span><span class=\"o\">.</span><span class=\"n\">in_stream</span><span class=\"p\">)))</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">char</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'\\r'</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"o\">!</span><span class=\"n\">isnothing</span><span class=\"p\">(</span><span class=\"n\">default</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">char</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">char</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'\\x03'</span><span class=\"w\"> </span><span class=\"c\"># ^C</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"\\e[m^C</span><span class=\"se\">\\n</span><span class=\"s\">\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"n\">throw</span><span class=\"p\">(</span><span class=\"kt\">InterruptException</span><span class=\"p\">())</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">Terminals</span><span class=\"o\">.</span><span class=\"n\">raw!</span><span class=\"p\">(</span><span class=\"n\">REPL</span><span class=\"o\">.</span><span class=\"n\">TerminalMenus</span><span class=\"o\">.</span><span class=\"n\">terminal</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"nb\">stdout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">:color</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"n\">Base</span><span class=\"o\">.</span><span class=\"n\">text_colors</span><span class=\"p\">[</span><span class=\"n\">REPL_USER_INPUT_COLOUR</span><span class=\"p\">])</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"nb\">stdout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">char</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"sc\">'\\n'</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">get</span><span class=\"p\">(</span><span class=\"nb\">stdout</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"ss\">:color</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nb\">false</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">&amp;&amp;</span><span class=\"w\"> </span><span class=\"n\">print</span><span class=\"p\">(</span><span class=\"s\">\"\\e[m\"</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">char</span><span class=\"w\"></span>\n<span class=\"k\">end</span><span class=\"w\"></span>\n\n<span class=\"s\">\"\"\"</span>\n<span class=\"s\">    confirm_yn(question::AbstractString, default::Bool=false)</span>\n<span class=\"s\">Interactively ask `question` and accept y/Y/n/N as the response.</span>\n<span class=\"s\">If any other key is pressed, then `default` will be taken as the response.</span>\n<span class=\"s\">A \" [y/n]: \" string will be appended to the question, with y/n capitalised</span>\n<span class=\"s\">to indicate the default value.</span>\n\n<span class=\"s\">### Example</span>\n\n<span class=\"s\">```julia-repl</span>\n<span class=\"s\">julia&gt; confirm_yn(\"Do you like chocolate?\", true)</span>\n<span class=\"s\">Do you like chocolate? [Y/n]: y</span>\n<span class=\"s\">true</span>\n<span class=\"s\">```</span>\n<span class=\"s\">\"\"\"</span><span class=\"w\"></span>\n<span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">confirm_yn</span><span class=\"p\">(</span><span class=\"n\">question</span><span class=\"o\">::</span><span class=\"kt\">AbstractString</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"o\">::</span><span class=\"kt\">Bool</span><span class=\"o\">=</span><span class=\"nb\">false</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">char</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">prompt_char</span><span class=\"p\">(</span><span class=\"n\">question</span><span class=\"w\"> </span><span class=\"o\">*</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"s\">\" [y/N]: \"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\" [Y/n]: \"</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"n\">default</span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">                       </span><span class=\"p\">[</span><span class=\"sc\">'y'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"sc\">'n'</span><span class=\"p\">],</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"sc\">'n'</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"sc\">'y'</span><span class=\"p\">)[</span><span class=\"mi\">1</span><span class=\"o\">+</span><span class=\"n\">default</span><span class=\"p\">])</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"n\">char</span><span class=\"w\"> </span><span class=\"o\">==</span><span class=\"w\"> </span><span class=\"sc\">'y'</span><span class=\"w\"></span>\n<span class=\"k\">end</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 311223488,
        "sender_full_name": "Timothy",
        "timestamp": 1669012897
    },
    {
        "content": "<p>So if during your development, you find any customizations and stuff you think might make a nice contribution to <a href=\"https://github.com/search?q=ReplMaker.jl&amp;type=Repositories\">ReplMaker.jl</a>, I'd be very glad to receive PRs</p>",
        "id": 311223506,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669012910
    },
    {
        "content": "<p>If I do end up going that way, I'll be sure to do so <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 311223651,
        "sender_full_name": "Timothy",
        "timestamp": 1669012971
    },
    {
        "content": "<p>Hmm, maybe it would be worth having something like <code>TermInteractionUtils.jl</code> which provides the sort of things you see in the gifs of the readme of <a href=\"https://github.com/charmbracelet/gum\">https://github.com/charmbracelet/gum</a></p>",
        "id": 311224005,
        "sender_full_name": "Timothy",
        "timestamp": 1669013208
    },
    {
        "content": "<p>Actually, I'd be potentially up for collaborating on something like that.</p>",
        "id": 311224200,
        "sender_full_name": "Timothy",
        "timestamp": 1669013338
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"269150\">Mason Protter</span> <a href=\"#narrow/stream/274208-helpdesk-.28published.29/topic/Temporary.20namespace/near/311220626\">said</a>:</p>\n<blockquote>\n<p>Here's how I'd approach it: [snip] <code>@eval module $(gensym(:Scratch)) end)</code> [snip]</p>\n</blockquote>\n<p>This seems to work well, thanks.</p>\n<p>Bonus complication: how hard would it be to make packages available in the current <code>Main</code> available in the created module too?</p>",
        "id": 311226310,
        "sender_full_name": "Timothy",
        "timestamp": 1669014663
    },
    {
        "content": "<p>You can take a look at the <a href=\"https://github.com/search?q=Infiltrator.jl&amp;type=Repositories\">Infiltrator.jl</a> source code. I'm doing a lot of stuff with anon modules and binding-imports/exports in there</p>",
        "id": 311296864,
        "sender_full_name": "Sebastian Pfitzner",
        "timestamp": 1669040980
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"400021\">Timothy</span> <a href=\"#narrow/stream/274208-helpdesk-.28published.29/topic/Temporary.20namespace/near/311226310\">said</a>:</p>\n<blockquote>\n<p>Bonus complication: how hard would it be to make packages available in the current <code>Main</code> available in the created module too?</p>\n</blockquote>\n<p>You could do something like</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"k\">let</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"nd\">@eval</span><span class=\"w\"> </span><span class=\"k\">module</span><span class=\"w\"> </span><span class=\"o\">$</span><span class=\"p\">(</span><span class=\"n\">gensym</span><span class=\"p\">(</span><span class=\"ss\">:Scratch</span><span class=\"p\">))</span><span class=\"w\"> </span><span class=\"k\">end</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">for</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"w\"> </span><span class=\"o\">∈</span><span class=\"w\"> </span><span class=\"n\">names</span><span class=\"p\">(</span><span class=\"n\">Main</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">all</span><span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"p\">)</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">getproperty</span><span class=\"p\">(</span><span class=\"n\">Main</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">s</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"k\">isa</span><span class=\"w\"> </span><span class=\"kt\">Module</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nd\">@eval</span><span class=\"w\"> </span><span class=\"n\">mod</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"o\">$</span><span class=\"n\">s</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"k\">end</span><span class=\"w\"></span>\n<span class=\"k\">end</span><span class=\"w\"></span>\n</code></pre></div>\n<p>But I guess that might cause a problem because there might be a discrepancy if the user did somehting like</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"o\">:</span><span class=\"w\"> </span><span class=\"n\">bar</span><span class=\"w\"></span>\n</code></pre></div>\n<p>instead of plain <code>using Foo</code></p>",
        "id": 311494261,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669074006
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"400021\">@Timothy</span>  you might find <a href=\"https://github.com/NHDaly/DeepcopyModules.jl\">https://github.com/NHDaly/DeepcopyModules.jl</a> helpful</p>",
        "id": 311495268,
        "sender_full_name": "Mason Protter",
        "timestamp": 1669074675
    },
    {
        "content": "<p>Thanks Mason, you've been wonderfully helpful to me as of late <span aria-label=\"hug\" class=\"emoji emoji-1f917\" role=\"img\" title=\"hug\">:hug:</span></p>",
        "id": 311502612,
        "sender_full_name": "Timothy",
        "timestamp": 1669079393
    }
]