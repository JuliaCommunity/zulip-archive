[
    {
        "content": "<p>Related to <a href=\"#narrow/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20Inverse.20normal.20transformation\">this question</a>, with a new wrinkle - my data is zero-in flated, so I'm running into this: <a href=\"/user_uploads/7178/kDltT4Po3YOUWJp2uUqtOIqM/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/7178/kDltT4Po3YOUWJp2uUqtOIqM/image.png\" title=\"image.png\"><img src=\"/user_uploads/7178/kDltT4Po3YOUWJp2uUqtOIqM/image.png\"></a></div><p>I need a way to make <code>rank</code> discontinuous, so equivalent values are given the same rank. Eg for <code>[1,0,0,2,0,1]</code>, I'd need ranks <code>[4,1,1,6,1,4]</code>. Though really, as long as all zeros get rank 1, that should be fine as a short-term solution. Here's a mock up of that solution</p>\n<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"k\">function</span> <span class=\"n\">getrank</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">;</span> <span class=\"n\">flattenzeros</span><span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"p\">)</span>\n    <span class=\"n\">r</span> <span class=\"o\">=</span> <span class=\"n\">invperm</span><span class=\"p\">(</span><span class=\"n\">sortperm</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">))</span>\n    <span class=\"k\">if</span> <span class=\"n\">flattenzeros</span>\n        <span class=\"n\">z</span> <span class=\"o\">=</span> <span class=\"n\">findall</span><span class=\"p\">(</span><span class=\"n\">iszero</span><span class=\"p\">,</span> <span class=\"n\">v</span><span class=\"p\">)</span>\n        <span class=\"n\">r</span><span class=\"p\">[</span><span class=\"n\">z</span><span class=\"p\">]</span> <span class=\"o\">.=</span> <span class=\"mi\">1</span>\n    <span class=\"k\">end</span>\n    <span class=\"k\">return</span> <span class=\"n\">r</span>\n<span class=\"k\">end</span>\n\n<span class=\"k\">function</span> <span class=\"n\">invnormaltransform</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">;</span> <span class=\"n\">μ</span><span class=\"o\">=</span><span class=\"mi\">0</span><span class=\"p\">,</span> <span class=\"n\">σ</span><span class=\"o\">=</span><span class=\"mi\">1</span><span class=\"p\">,</span> <span class=\"n\">c</span><span class=\"o\">=</span><span class=\"mi\">3</span><span class=\"o\">/</span><span class=\"mi\">8</span><span class=\"p\">,</span> <span class=\"n\">flattenzeros</span><span class=\"o\">=</span><span class=\"nb\">true</span><span class=\"p\">)</span>\n    <span class=\"n\">rank</span> <span class=\"o\">=</span> <span class=\"n\">getrank</span><span class=\"p\">(</span><span class=\"n\">v</span><span class=\"p\">;</span> <span class=\"n\">flattenzeros</span><span class=\"p\">)</span>\n    <span class=\"k\">return</span> <span class=\"p\">[</span><span class=\"n\">norminvcdf</span><span class=\"p\">(</span><span class=\"n\">μ</span><span class=\"p\">,</span> <span class=\"n\">σ</span><span class=\"p\">,</span> <span class=\"p\">(</span><span class=\"n\">x</span> <span class=\"o\">-</span> <span class=\"n\">c</span><span class=\"p\">)</span> <span class=\"o\">/</span> <span class=\"p\">(</span><span class=\"n\">N</span> <span class=\"o\">-</span> <span class=\"mi\">2</span><span class=\"n\">c</span> <span class=\"o\">+</span> <span class=\"mi\">1</span><span class=\"p\">))</span> <span class=\"k\">for</span> <span class=\"n\">x</span> <span class=\"k\">in</span> <span class=\"n\">rank</span><span class=\"p\">]</span>\n<span class=\"k\">end</span>\n</code></pre></div>\n<p>which gives me <a href=\"/user_uploads/7178/omg943Od1ez4hkvRDSWor5k-/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/7178/omg943Od1ez4hkvRDSWor5k-/image.png\" title=\"image.png\"><img src=\"/user_uploads/7178/omg943Od1ez4hkvRDSWor5k-/image.png\"></a></div>",
        "id": 248509742,
        "sender_full_name": "Kevin Bonham",
        "timestamp": 1628184798
    }
]