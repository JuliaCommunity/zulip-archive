[
    {
        "content": "<p>You can manually check the common types, and if it's none of those, you can call a noinlined function that checks the other types</p>",
        "id": 561011445,
        "sender_full_name": "Jakob Nybo Andersen",
        "timestamp": 1764518908
    },
    {
        "content": "<p>Could you please share an example? I'm not sure I'm following the approach you have in mind.</p>",
        "id": 561011731,
        "sender_full_name": "Júlio Hoffimann",
        "timestamp": 1764519121
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"Julia\"><pre><span></span><code><span class=\"w\">       </span><span class=\"k\">struct</span> <span class=\"kt\">Foo</span>\n<span class=\"w\">           </span><span class=\"n\">x</span><span class=\"o\">::</span><span class=\"kt\">Union</span><span class=\"p\">{</span><span class=\"kt\">Int</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">UInt</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">Int32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">UInt32</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">Int8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">UInt8</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">Int16</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"kt\">UInt16</span><span class=\"p\">}</span>\n<span class=\"w\">       </span><span class=\"k\">end</span>\n\n<span class=\"w\">       </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">foo</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"o\">::</span><span class=\"kt\">Foo</span><span class=\"p\">)</span>\n<span class=\"w\">           </span><span class=\"n\">xx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">x</span>\n<span class=\"w\">           </span><span class=\"c\"># Handle the most common types</span>\n<span class=\"w\">           </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"k\">if</span><span class=\"w\"> </span><span class=\"n\">xx</span><span class=\"w\"> </span><span class=\"k\">isa</span><span class=\"w\"> </span><span class=\"kt\">Int</span>\n<span class=\"w\">               </span><span class=\"n\">xx</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">1</span>\n<span class=\"w\">           </span><span class=\"k\">elseif</span><span class=\"w\"> </span><span class=\"n\">xx</span><span class=\"w\"> </span><span class=\"k\">isa</span><span class=\"w\"> </span><span class=\"kt\">UInt</span>\n<span class=\"w\">               </span><span class=\"p\">(</span><span class=\"n\">xx</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"kt\">Int</span><span class=\"p\">)</span><span class=\"w\"> </span><span class=\"o\">+</span><span class=\"w\"> </span><span class=\"mi\">2</span>\n<span class=\"w\">           </span><span class=\"k\">else</span>\n<span class=\"w\">               </span><span class=\"n\">foo_outlined</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n<span class=\"w\">           </span><span class=\"k\">end</span>\n<span class=\"w\">       </span><span class=\"k\">end</span>\n\n<span class=\"w\">       </span><span class=\"nd\">@noinline</span><span class=\"w\"> </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"n\">foo_outlined</span><span class=\"p\">(</span><span class=\"n\">x</span><span class=\"p\">)</span>\n<span class=\"w\">           </span><span class=\"n\">xx</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"o\">.</span><span class=\"n\">x</span>\n<span class=\"w\">           </span><span class=\"k\">return</span><span class=\"w\"> </span><span class=\"n\">xx</span><span class=\"w\"> </span><span class=\"o\">%</span><span class=\"w\"> </span><span class=\"kt\">Int</span>\n<span class=\"w\">           </span><span class=\"c\"># Handle all other types than Int and UInt here</span>\n<span class=\"w\">       </span><span class=\"k\">end</span>\n</code></pre></div>\n<p>This makes <code>foo</code> very efficient, since it just checks two types.</p>",
        "id": 561013970,
        "sender_full_name": "Jakob Nybo Andersen",
        "timestamp": 1764520920
    },
    {
        "content": "<p>Note that in the case above, it's efficient partly because it always returns an <code>Int</code>. If it needs to return some large union, it's slow, and you'd need to return a struct wrapping the union instead</p>",
        "id": 561014029,
        "sender_full_name": "Jakob Nybo Andersen",
        "timestamp": 1764520983
    },
    {
        "content": "<p>I did some tests locally and the gain is too small to justify the optimization. I will keep the code as is for now. Thank you!</p>",
        "id": 561040336,
        "sender_full_name": "Júlio Hoffimann",
        "timestamp": 1764543874
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"273172\">Júlio Hoffimann</span> has marked this topic as resolved.</p>",
        "id": 561040342,
        "sender_full_name": "Notification Bot",
        "timestamp": 1764543880
    }
]