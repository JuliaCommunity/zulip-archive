[
    {
        "content": "<p>I am trying to use <code>PythonCall.pytype</code> to define a sub-class of a Python class - i.e. to define it using Julia code, but so far I can not figure out how to do the <code>super().__init__(...)</code> constructor call...</p>\n<div class=\"codehilite\" data-code-language=\"Julia console\"><pre><span></span><code><span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"k\">using</span><span class=\"w\"> </span><span class=\"n\">PythonCall</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pytype</span><span class=\"p\">(</span><span class=\"s\">\"Foo\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(),</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">           </span><span class=\"s\">\"__module__\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"s\">\"__main__\"</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"n\">pyfunc</span><span class=\"p\">(</span>\n<span class=\"w\">               </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"__init__\"</span><span class=\"p\">,</span>\n<span class=\"w\">               </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">nothing</span><span class=\"p\">)</span>\n<span class=\"w\">                   </span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">y</span>\n<span class=\"w\">                   </span><span class=\"k\">return</span>\n<span class=\"w\">               </span><span class=\"k\">end</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"p\">),</span>\n<span class=\"w\">           </span><span class=\"n\">pyfunc</span><span class=\"p\">(</span>\n<span class=\"w\">               </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"__repr__\"</span><span class=\"p\">,</span>\n<span class=\"w\">               </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"s\">\"Foo(</span><span class=\"si\">$</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"s\">)\"</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"p\">),</span>\n<span class=\"w\">       </span><span class=\"p\">])</span>\n<span class=\"go\">Python: &lt;class '__main__.Foo'&gt;</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pytype</span><span class=\"p\">(</span><span class=\"s\">\"Bar\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Foo</span><span class=\"p\">,),</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">           </span><span class=\"s\">\"__module__\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"s\">\"__main__\"</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"n\">pyfunc</span><span class=\"p\">(</span>\n<span class=\"w\">               </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"__init__\"</span><span class=\"p\">,</span>\n<span class=\"w\">               </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">nothing</span><span class=\"p\">)</span>\n<span class=\"w\">                   </span><span class=\"n\">pyeval</span><span class=\"p\">(</span><span class=\"kt\">Any</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"s\">\"super().__init__(y)\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"nd\">@__MODULE__</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"p\">))</span>\n<span class=\"w\">                   </span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">                   </span><span class=\"k\">return</span>\n<span class=\"w\">               </span><span class=\"k\">end</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"p\">),</span>\n<span class=\"w\">           </span><span class=\"n\">pyfunc</span><span class=\"p\">(</span>\n<span class=\"w\">               </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"__repr__\"</span><span class=\"p\">,</span>\n<span class=\"w\">               </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"s\">\"Bar(</span><span class=\"si\">$</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"s\">, </span><span class=\"si\">$</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"s\">)\"</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"p\">),</span>\n<span class=\"w\">       </span><span class=\"p\">])</span>\n<span class=\"go\">Python: &lt;class '__main__.Bar'&gt;</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"p\">()</span>\n<span class=\"go\">Python: Foo(None)</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"go\">Python: Foo(1)</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"gr\">ERROR: Python: RuntimeError: super(): no arguments</span>\n<span class=\"gr\">...</span>\n</code></pre></div>\n<p>Any tips?</p>",
        "id": 385140270,
        "sender_full_name": "Jesper Stemann Andersen",
        "timestamp": 1692109601
    },
    {
        "content": "<p><code>pybuiltins.super()</code> seems promising...</p>\n<div class=\"codehilite\" data-code-language=\"Julia console\"><pre><span></span><code><span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pytype</span><span class=\"p\">(</span><span class=\"s\">\"Bar\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Foo</span><span class=\"p\">,),</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">           </span><span class=\"s\">\"__module__\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"s\">\"__main__\"</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"n\">pyfunc</span><span class=\"p\">(</span>\n<span class=\"w\">               </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"__init__\"</span><span class=\"p\">,</span>\n<span class=\"w\">               </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">nothing</span><span class=\"p\">)</span>\n<span class=\"w\">                   </span><span class=\"n\">pybuiltins</span><span class=\"o\">.</span><span class=\"n\">super</span><span class=\"p\">()</span><span class=\"o\">.</span><span class=\"n\">__init__</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"p\">)</span>\n<span class=\"w\">                   </span><span class=\"c\"># pyeval(Any, \"super().__init__(y)\", @__MODULE__, (self = self, y = y))</span>\n<span class=\"w\">                   </span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">                   </span><span class=\"k\">return</span>\n<span class=\"w\">               </span><span class=\"k\">end</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"p\">),</span>\n<span class=\"w\">           </span><span class=\"n\">pyfunc</span><span class=\"p\">(</span>\n<span class=\"w\">               </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"__repr__\"</span><span class=\"p\">,</span>\n<span class=\"w\">               </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"s\">\"Bar(</span><span class=\"si\">$</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"s\">, </span><span class=\"si\">$</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"s\">)\"</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"p\">),</span>\n<span class=\"w\">       </span><span class=\"p\">])</span>\n<span class=\"go\">Python: &lt;class '__main__.Bar'&gt;</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"gr\">ERROR: Python: RuntimeError: super(): __class__ cell not found</span>\n<span class=\"gr\">...</span>\n</code></pre></div>\n<p>Likely related open Python bug: <a href=\"https://bugs.python.org/issue29944\">https://bugs.python.org/issue29944</a></p>",
        "id": 385143614,
        "sender_full_name": "Jesper Stemann Andersen",
        "timestamp": 1692110297
    },
    {
        "content": "<p>Solution:</p>\n<div class=\"codehilite\" data-code-language=\"Julia console\"><pre><span></span><code><span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">pytype</span><span class=\"p\">(</span><span class=\"s\">\"Bar\"</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">Foo</span><span class=\"p\">,),</span><span class=\"w\"> </span><span class=\"p\">[</span>\n<span class=\"w\">           </span><span class=\"s\">\"__module__\"</span><span class=\"w\"> </span><span class=\"o\">=&gt;</span><span class=\"w\"> </span><span class=\"s\">\"__main__\"</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"n\">pyfunc</span><span class=\"p\">(</span>\n<span class=\"w\">               </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"__init__\"</span><span class=\"p\">,</span>\n<span class=\"w\">               </span><span class=\"k\">function</span><span class=\"w\"> </span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">x</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">y</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"nb\">nothing</span><span class=\"p\">)</span>\n<span class=\"w\">                   </span><span class=\"n\">pybuiltins</span><span class=\"o\">.</span><span class=\"n\">super</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">__class__</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"n\">self</span><span class=\"p\">)</span><span class=\"o\">.</span><span class=\"n\">__init__</span><span class=\"p\">(</span><span class=\"n\">y</span><span class=\"p\">)</span>\n<span class=\"w\">                   </span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">x</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"n\">x</span>\n<span class=\"w\">                   </span><span class=\"k\">return</span>\n<span class=\"w\">               </span><span class=\"k\">end</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"p\">),</span>\n<span class=\"w\">           </span><span class=\"n\">pyfunc</span><span class=\"p\">(</span>\n<span class=\"w\">               </span><span class=\"n\">name</span><span class=\"w\"> </span><span class=\"o\">=</span><span class=\"w\"> </span><span class=\"s\">\"__repr__\"</span><span class=\"p\">,</span>\n<span class=\"w\">               </span><span class=\"n\">self</span><span class=\"w\"> </span><span class=\"o\">-&gt;</span><span class=\"w\"> </span><span class=\"s\">\"Bar(</span><span class=\"si\">$</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">x</span><span class=\"p\">)</span><span class=\"s\">, </span><span class=\"si\">$</span><span class=\"p\">(</span><span class=\"n\">self</span><span class=\"o\">.</span><span class=\"n\">y</span><span class=\"p\">)</span><span class=\"s\">)\"</span><span class=\"p\">,</span>\n<span class=\"w\">           </span><span class=\"p\">),</span>\n<span class=\"w\">       </span><span class=\"p\">])</span>\n<span class=\"go\">Python: &lt;class '__main__.Bar'&gt;</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"p\">()</span>\n<span class=\"go\">Python: Foo(None)</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Foo</span><span class=\"p\">(</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n<span class=\"go\">Python: Foo(1)</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">)</span>\n<span class=\"go\">Python: Bar(2, None)</span>\n\n<span class=\"gp\">julia&gt;</span><span class=\"w\"> </span><span class=\"n\">Bar</span><span class=\"p\">(</span><span class=\"mi\">2</span><span class=\"p\">,</span><span class=\"w\"> </span><span class=\"mi\">3</span><span class=\"p\">)</span>\n<span class=\"go\">Python: Bar(2, 3)</span>\n</code></pre></div>",
        "id": 385146038,
        "sender_full_name": "Jesper Stemann Andersen",
        "timestamp": 1692110684
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"432905\">Jesper Stemann Andersen</span> has marked this topic as resolved.</p>",
        "id": 385146606,
        "sender_full_name": "Notification Bot",
        "timestamp": 1692110791
    }
]