<html>
<head><meta charset="utf-8"><title>DICOM.jl not loading a directory · helpdesk (published) · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/index.html">helpdesk (published)</a></h2>
<h3>Topic: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html">DICOM.jl not loading a directory</a></h3>

<hr>

<base href="https://julialang.zulipchat.com">

<head><link href="https://juliacommunity.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="262820816"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262820816" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Black <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262820816">(Nov 26 2021 at 17:36)</a>:</h4>
<p>I am trying to load a DICOM directory using <code>dcmdir_parse(dcm_path)</code> and it's returning this error:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="kt">BoundsError</span><span class="o">:</span> <span class="n">attempt</span> <span class="n">to</span> <span class="n">access</span> <span class="mi">0</span><span class="o">-</span><span class="n">element</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">UInt8</span><span class="p">}</span> <span class="n">at</span> <span class="n">index</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span>

<span class="n">throw_boundserror</span><span class="p">(</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">UInt8</span><span class="p">},</span> <span class="o">::</span><span class="kt">Tuple</span><span class="p">{</span><span class="kt">UnitRange</span><span class="p">{</span><span class="kt">Int64</span><span class="p">}})</span><span class="nd">@abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">651</span>
<span class="n">checkbounds</span><span class="nd">@abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">616</span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
<span class="n">getindex</span><span class="nd">@array</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">807</span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
<span class="n">isdicom</span><span class="p">(</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span><span class="nd">@DICOM</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">139</span>
<span class="c">#7@DICOM.jl:134[inlined]</span>
<span class="n">filter</span><span class="p">(</span><span class="o">::</span><span class="kt">DICOM</span><span class="o">.</span><span class="sa">var</span><span class="s">"#7#8"</span><span class="p">,</span> <span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">String</span><span class="p">})</span><span class="nd">@array</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">2507</span>
<span class="n">find_dicom_files</span><span class="p">(</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span><span class="nd">@DICOM</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">134</span>
<span class="c">#dcmdir_parse#9@DICOM.jl:144[inlined]</span>
<span class="n">dcmdir_parse</span><span class="nd">@DICOM</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">144</span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
<span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span><span class="nd">@Local</span><span class="o">:</span> <span class="mi">1</span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
</code></pre></div>
<p>This loads fine using pydicom or ImageJ. Are there any tricks to making this work with <a href="https://github.com/search?q=DICOM.jl&amp;type=Repositories">DICOM.jl</a> that I am missing?</p>
<p>Here it is in imageJ with some header info:<br>
<a href="/user_uploads/7178/hRfebSzcGnarK4mzTT3B-cy3/image.png">image.png</a></p>
<div class="message_inline_image"><a href="/user_uploads/7178/hRfebSzcGnarK4mzTT3B-cy3/image.png" title="image.png"><img src="/user_uploads/7178/hRfebSzcGnarK4mzTT3B-cy3/image.png"></a></div>



<a name="262821281"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262821281" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Black <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262821281">(Nov 26 2021 at 17:42)</a>:</h4>
<p>For reference, <code>dcm_parse(dcm_file)</code> works fine with an individual file from that same directory, but <code>DICOM.find_dicom_files(dcm_path)</code> returns a similar error as the one above:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="kt">BoundsError</span><span class="o">:</span> <span class="n">attempt</span> <span class="n">to</span> <span class="n">access</span> <span class="mi">0</span><span class="o">-</span><span class="n">element</span> <span class="kt">Vector</span><span class="p">{</span><span class="kt">UInt8</span><span class="p">}</span> <span class="n">at</span> <span class="n">index</span> <span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="o">:</span><span class="mi">0</span><span class="p">]</span>

<span class="n">throw_boundserror</span><span class="p">(</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">UInt8</span><span class="p">},</span> <span class="o">::</span><span class="kt">Tuple</span><span class="p">{</span><span class="kt">UnitRange</span><span class="p">{</span><span class="kt">Int64</span><span class="p">}})</span><span class="nd">@abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">651</span>
<span class="n">checkbounds</span><span class="nd">@abstractarray</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">616</span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
<span class="n">getindex</span><span class="nd">@array</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">807</span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
<span class="n">isdicom</span><span class="p">(</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span><span class="nd">@DICOM</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">139</span>
<span class="c">#7@DICOM.jl:134[inlined]</span>
<span class="n">filter</span><span class="p">(</span><span class="o">::</span><span class="kt">DICOM</span><span class="o">.</span><span class="sa">var</span><span class="s">"#7#8"</span><span class="p">,</span> <span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">String</span><span class="p">})</span><span class="nd">@array</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">2507</span>
<span class="n">find_dicom_files</span><span class="p">(</span><span class="o">::</span><span class="kt">String</span><span class="p">)</span><span class="nd">@DICOM</span><span class="o">.</span><span class="n">jl</span><span class="o">:</span><span class="mi">134</span>
<span class="n">top</span><span class="o">-</span><span class="n">level</span> <span class="n">scope</span><span class="nd">@Local</span><span class="o">:</span> <span class="mi">1</span><span class="p">[</span><span class="n">inlined</span><span class="p">]</span>
</code></pre></div>



<a name="262840446"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262840446" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sundar R <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262840446">(Nov 26 2021 at 22:54)</a>:</h4>
<p>Is there an empty file in that directory?</p>



<a name="262840597"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262840597" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sundar R <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262840597">(Nov 26 2021 at 22:57)</a>:</h4>
<p>It seems to be a bug in <a href="https://github.com/search?q=DICOM.jl&amp;type=Repositories">DICOM.jl</a> <a href="https://github.com/JuliaHealth/DICOM.jl/blob/master/src/DICOM.jl#L139">here</a>, where it assumes that every file in the directory has at least 132 bytes to read from it. In your case, there's either an empty file or soemthing that's being read as an empty file, hence the error.</p>



<a name="262841110"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262841110" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Black <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262841110">(Nov 26 2021 at 23:06)</a>:</h4>
<p>Oh, it does contain these two files <code>".DS_Store"</code> <code>"Icon\r"</code>which I have noticed pop up from time to time and seem to be associated with vscode. Do you have any insight into this, since this might be an easier fix than modifying the <a href="https://github.com/search?q=DICOM.jl&amp;type=Repositories">DICOM.jl</a> code</p>



<a name="262841230"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262841230" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sukera <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262841230">(Nov 26 2021 at 23:08)</a>:</h4>
<p><code>.DS_Store</code> and <code>Icon</code> are a mac-specific metadata store for the files of a directory</p>



<a name="262841457"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262841457" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Black <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262841457">(Nov 26 2021 at 23:13)</a>:</h4>
<p>Oh, so nothing I can do to avoid those then?</p>



<a name="262841519"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262841519" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Black <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262841519">(Nov 26 2021 at 23:14)</a>:</h4>
<p>Also, it looks like the function <code>find_dicom_files</code> found <a href="https://github.com/JuliaHealth/DICOM.jl/blob/d1e5567a6c24b59b6d8ed03044950b0146d64e27/src/DICOM.jl#L132">here</a> should be able to skip any non-dicom files in the folder, so I am not sure why that would be an issue?</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="k">function</span> <span class="n">find_dicom_files</span><span class="p">(</span><span class="n">dir</span><span class="p">)</span>
    <span class="n">files</span> <span class="o">=</span> <span class="n">joinpath</span><span class="o">.</span><span class="p">(</span><span class="n">dir</span><span class="p">,</span> <span class="n">readdir</span><span class="p">(</span><span class="n">dir</span><span class="p">))</span>
    <span class="n">dicom_files</span> <span class="o">=</span> <span class="n">filter</span><span class="p">(</span><span class="n">file</span> <span class="o">-&gt;</span> <span class="n">isdicom</span><span class="p">(</span><span class="n">file</span><span class="p">),</span> <span class="n">files</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dicom_files</span>
<span class="k">end</span>
</code></pre></div>



<a name="262841661"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262841661" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Black <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262841661">(Nov 26 2021 at 23:17)</a>:</h4>
<p>Oh wait, you're right <span class="user-mention" data-user-id="423970">@Sundar R</span>. If I delete the <code>Icon</code> and <code>.DS_Store</code>, both <code>find_dicom_files</code> and <code>dcmdir_parse</code> work, but when those are included, neither of the functions work</p>



<a name="262842651"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262842651" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sundar R <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262842651">(Nov 26 2021 at 23:41)</a>:</h4>
<p><span class="user-mention silent" data-user-id="352971">Dale Black</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory/near/262841457">said</a>:</p>
<blockquote>
<p>Oh, so nothing I can do to avoid those then?</p>
</blockquote>
<p>There seem to be some third party tools: <a href="https://apple.stackexchange.com/a/296000">https://apple.stackexchange.com/a/296000</a> to avoid those files, but I don't use a Mac and can't recommend any of it myself. It's probably overkill anyway if this is the only place it bothers you, this should be fixed at the package level.</p>



<a name="262842733"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262842733" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sundar R <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262842733">(Nov 26 2021 at 23:43)</a>:</h4>
<p><span class="user-mention silent" data-user-id="352971">Dale Black</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory/near/262841519">said</a>:</p>
<blockquote>
<p>Also, it looks like the function <code>find_dicom_files</code> found <a href="https://github.com/JuliaHealth/DICOM.jl/blob/d1e5567a6c24b59b6d8ed03044950b0146d64e27/src/DICOM.jl#L132">here</a> should be able to skip any non-dicom files in the folder, so I am not sure why that would be an issue?<br>
</p>
</blockquote>
<p>It tries to do that by reading every file in the directory (regardless of name or extension), and seeing if the initial bytes match what a DICOM file should have. The <code>isdicom(file)</code> call in the second line is the one that does that, and that's where the problem comes from.</p>



<a name="262847681"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/DICOM.jl%20not%20loading%20a%20directory/near/262847681" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Dale Black <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/DICOM.2Ejl.20not.20loading.20a.20directory.html#262847681">(Nov 27 2021 at 01:53)</a>:</h4>
<p>Thank you, this seems to fix the problem so I made a PR to <a href="https://github.com/search?q=DICOM.jl&amp;type=Repositories">DICOM.jl</a>. I am sure they will tell me if there is a better way to go about this</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="k">function</span> <span class="n">isdicom</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">try</span>
        <span class="n">bytes</span> <span class="o">=</span> <span class="n">read</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="mi">132</span><span class="p">)[</span><span class="k">end</span><span class="o">-</span><span class="mi">3</span><span class="o">:</span><span class="k">end</span><span class="p">]</span>
        <span class="kt">String</span><span class="p">(</span><span class="n">bytes</span><span class="p">)</span> <span class="o">==</span> <span class="s">"DICM"</span>
    <span class="k">catch</span>
        <span class="nb">false</span>
    <span class="k">end</span>
<span class="k">end</span>
</code></pre></div>



<hr><p>Last updated: Nov 01 2025 at 04:39 UTC</p>
</html>