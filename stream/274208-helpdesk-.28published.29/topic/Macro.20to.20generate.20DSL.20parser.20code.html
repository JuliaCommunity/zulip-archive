<html>
<head><meta charset="utf-8"><title>Macro to generate DSL parser code · helpdesk (published) · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/index.html">helpdesk (published)</a></h2>
<h3>Topic: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Macro.20to.20generate.20DSL.20parser.20code.html">Macro to generate DSL parser code</a></h3>

<hr>

<base href="https://julialang.zulipchat.com">

<head><link href="https://juliacommunity.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="547401382"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Macro%20to%20generate%20DSL%20parser%20code/near/547401382" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Viktor G. <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Macro.20to.20generate.20DSL.20parser.20code.html#547401382">(Oct 28 2025 at 02:39)</a>:</h4>
<p>I want to write a bunch of rules that check strings of <code>;</code>-separated words like <code>"word1;word2;word3;word4"</code>, using logical expressions with braces like: <code>"word1&amp;word2|(!prefix3*&amp;!word4)"</code>. Writing this out in regex generates very long and buggy expressions. However, code for each expression looks simple, there is just too many of them, so I want to shorten it. Optimally, just write some macro and apply it to a bunch of string rules to generate functions. What is a common way to do it?</p>



<a name="547402668"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Macro%20to%20generate%20DSL%20parser%20code/near/547402668" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Morris <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Macro.20to.20generate.20DSL.20parser.20code.html#547402668">(Oct 28 2025 at 02:59)</a>:</h4>
<p>Have you considered a parser expression grammar like <a href="https://juliaregistries.github.io/General/packages/redirect_to_repo/PEG">PEG.jl</a> ?</p>



<a name="547406517"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Macro%20to%20generate%20DSL%20parser%20code/near/547406517" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Viktor G. <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Macro.20to.20generate.20DSL.20parser.20code.html#547406517">(Oct 28 2025 at 04:00)</a>:</h4>
<p>I just don't get their examples and how to define functions based on their AST.</p>



<a name="547618405"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Macro%20to%20generate%20DSL%20parser%20code/near/547618405" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Viktor G. <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Macro.20to.20generate.20DSL.20parser.20code.html#547618405">(Oct 29 2025 at 02:26)</a>:</h4>
<p>So that is what I basically need - generating Julia function from PEG parser. But for now I don't understand, what additional rules are needed to parse prefixes and braces:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="k">using</span><span class="w"> </span><span class="n">PEG</span>

<span class="nd">@rule</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="sa">r</span><span class="sr">"</span><span class="err">\</span><span class="sr">w+"</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">w</span><span class="o">-&gt;</span><span class="w"> </span><span class="o">:</span><span class="p">(</span><span class="n">contains</span><span class="p">(</span><span class="n">str</span><span class="p">,</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">w</span><span class="p">)))</span>
<span class="nd">@rule</span><span class="w"> </span><span class="n">formula</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">word</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">calculate</span>
<span class="nd">@rule</span><span class="w"> </span><span class="n">operation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"|"</span><span class="p">,</span><span class="w"> </span><span class="s">"&amp;"</span>
<span class="c"># rule for "prefix*" ?</span>
<span class="c"># rule for any braces ?</span>

<span class="k">function</span><span class="w"> </span><span class="n">calculate</span><span class="p">(</span><span class="n">expression</span><span class="p">)</span>
<span class="w">    </span><span class="n">left</span><span class="p">,</span><span class="w"> </span><span class="n">op</span><span class="p">,</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">expression</span>
<span class="w">    </span><span class="n">sym_op</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">Symbol</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="o">:</span><span class="p">(</span><span class="o">$</span><span class="p">(</span><span class="n">sym_op</span><span class="p">)(</span><span class="o">$</span><span class="p">(</span><span class="n">left</span><span class="p">),</span><span class="w"> </span><span class="o">$</span><span class="p">(</span><span class="n">right</span><span class="p">)))</span>
<span class="k">end</span>

<span class="n">pattern1</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">"hello|world"</span>
<span class="nd">@generated</span><span class="w"> </span><span class="k">function</span><span class="w"> </span><span class="n">compiled_pattern1</span><span class="p">(</span><span class="n">str</span><span class="p">)</span>
<span class="w">    </span><span class="n">parse_whole</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span><span class="w"> </span><span class="n">pattern1</span><span class="p">)</span>
<span class="k">end</span>

<span class="n">compiled_pattern1</span><span class="p">(</span><span class="s">"hello there"</span><span class="p">)</span>

<span class="c"># What rules should I add for expressions with braces and prefixes?</span>
<span class="c"># "(jul*|rust)&amp;!(cpp)&amp;(hello|hi)"</span>
</code></pre></div>



<a name="547625784"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Macro%20to%20generate%20DSL%20parser%20code/near/547625784" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Luke Morris <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Macro.20to.20generate.20DSL.20parser.20code.html#547625784">(Oct 29 2025 at 04:11)</a>:</h4>
<p>Hmm, there might be some examples in <a href="https://github.com/AlgebraicJulia/DiagrammaticEquations.jl/blob/main/src/parser.jl">here</a> that could be useful to you.</p>



<hr><p>Last updated: Nov 01 2025 at 04:39 UTC</p>
</html>