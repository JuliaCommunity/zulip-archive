<html>
<head><meta charset="utf-8"><title>✔ Agents.jl &quot;no possible aggregation&quot; · helpdesk (published) · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/index.html">helpdesk (published)</a></h2>
<h3>Topic: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20Agents.2Ejl.20.22no.20possible.20aggregation.22.html">✔ Agents.jl &quot;no possible aggregation&quot;</a></h3>

<hr>

<base href="https://julialang.zulipchat.com">

<head><link href="https://juliacommunity.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="288204514"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20Agents.jl%20%22no%20possible%20aggregation%22/near/288204514" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lorenzo Gaifas <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20Agents.2Ejl.20.22no.20possible.20aggregation.22.html#288204514">(Jul 01 2022 at 17:50)</a>:</h4>
<p>I have an agent based model from which I'm attempting to aggregate data. If each of my agents has an <code>energy</code> field, I can do this:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="n">energy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="n">energy</span><span class="w"></span>
<span class="n">adata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="n">energy</span><span class="p">,</span><span class="w"> </span><span class="n">mean</span><span class="p">)]</span><span class="w"></span>
<span class="n">fig</span><span class="p">,</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">abmexploration</span><span class="p">(</span><span class="w"></span>
<span class="w">    </span><span class="n">model</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">agent_step!</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">model_step!</span><span class="p">,</span><span class="w"></span>
<span class="w">    </span><span class="n">adata</span><span class="p">,</span><span class="w"></span>
<span class="p">)</span><span class="w"></span>
</code></pre></div>
<p>and all works well. However, I would like to exclude some agents from the aggregation (it's a mixed agent model, and for some types the <code>energy</code> field should not even be there). To do so, I thought I could use <code>NaN</code> to my advantage:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="n">energy</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="k">isa</span><span class="w"> </span><span class="n">MyAgentType1</span><span class="w"> </span><span class="o">?</span><span class="w"> </span><span class="n">a</span><span class="o">.</span><span class="n">energy</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="nb">NaN</span><span class="w"></span>
<span class="n">nanmean</span><span class="p">(</span><span class="n">collection</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean</span><span class="p">(</span><span class="n">filter</span><span class="p">(</span><span class="o">!</span><span class="n">isnan</span><span class="p">,</span><span class="w">  </span><span class="n">collection</span><span class="p">))</span><span class="w"></span>
<span class="n">adata</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[(</span><span class="n">energy</span><span class="p">,</span><span class="w"> </span><span class="n">nanmean</span><span class="p">)]</span><span class="w"></span>
</code></pre></div>
<p>However, this produces a rather cryptic error:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="n">No</span><span class="w"> </span><span class="n">possible</span><span class="w"> </span><span class="n">aggregation</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">energy</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">nanmean</span><span class="w"></span>

<span class="w">    </span><span class="n">multi_agent_agg_types!</span><span class="p">(</span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Vector</span><span class="p">},</span><span class="w"> </span><span class="o">::</span><span class="kt">Tuple</span><span class="p">{</span><span class="kt">DataType</span><span class="p">,</span><span class="w"> </span><span class="kt">DataType</span><span class="p">},</span><span class="w"> </span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">String</span><span class="p">},</span><span class="w"> </span><span class="o">::</span><span class="kt">Agents</span><span class="o">.</span><span class="kt">AgentBasedModel</span><span class="p">{</span><span class="kt">Agents</span><span class="o">.</span><span class="kt">ContinuousSpace</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="kt">Float64</span><span class="p">,</span><span class="w"> </span><span class="kt">typeof</span><span class="p">(</span><span class="kt">Agents</span><span class="o">.</span><span class="kt">defvel</span><span class="p">)},</span><span class="w"> </span><span class="kt">Union</span><span class="p">{</span><span class="kt">Main</span><span class="o">.</span><span class="kt">workspace</span><span class="c">#3.Blob, Main.workspace#3.Food}, Agents.Schedulers.Randomly, Dict{Symbol, Int64}, Random.TaskLocalRNG}, ::Vector{Tuple{typeof(Main.workspace#3.energy), typeof(Main.workspace#5.nanmean)}})@collect.jl:381</span><span class="w"></span>
<span class="w">    </span><span class="kt">init_agent_dataframe</span><span class="p">(</span><span class="o">::</span><span class="kt">Agents</span><span class="o">.</span><span class="kt">AgentBasedModel</span><span class="p">{</span><span class="kt">Agents</span><span class="o">.</span><span class="kt">ContinuousSpace</span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="kt">true</span><span class="p">,</span><span class="w"> </span><span class="kt">Float64</span><span class="p">,</span><span class="w"> </span><span class="kt">typeof</span><span class="p">(</span><span class="kt">Agents</span><span class="o">.</span><span class="kt">defvel</span><span class="p">)},</span><span class="w"> </span><span class="kt">Union</span><span class="p">{</span><span class="kt">Main</span><span class="o">.</span><span class="kt">workspace</span><span class="c">#3.Blob, Main.workspace#3.Food}, Agents.Schedulers.Randomly, Dict{Symbol, Int64}, Random.TaskLocalRNG}, ::Vector{Tuple{typeof(Main.workspace#3.energy), typeof(Main.workspace#5.nanmean)}})@collect.jl:317</span><span class="w"></span>
<span class="w">    </span><span class="kt">var</span><span class="s">"#ABMObservable#27"</span><span class="p">(</span><span class="o">::</span><span class="kt">Function</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="kt">Function</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Tuple</span><span class="p">{</span><span class="kt">typeof</span><span class="p">(</span><span class="kt">Main</span><span class="o">.</span><span class="kt">workspace</span><span class="c">#3.energy), typeof(Main.workspace#5.nanmean)}}, ::Nothing, ::Bool, ::Type{InteractiveDynamics.ABMObservable}, ::Agents.AgentBasedModel{Agents.ContinuousSpace{2, true, Float64, typeof(Agents.defvel)}, Union{Main.workspace#3.Blob, Main.workspace#3.Food}, Agents.Schedulers.Randomly, Dict{Symbol, Int64}, Random.TaskLocalRNG})@model_observable.jl:40</span><span class="w"></span>
<span class="w">    </span><span class="kt">var</span><span class="s">"#abmplot!#30"</span><span class="p">(</span><span class="o">::</span><span class="kt">Function</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="kt">Function</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="kt">Vector</span><span class="p">{</span><span class="kt">Tuple</span><span class="p">{</span><span class="kt">typeof</span><span class="p">(</span><span class="kt">Main</span><span class="o">.</span><span class="kt">workspace</span><span class="c">#3.energy), typeof(Main.workspace#5.nanmean)}}, ::Nothing, ::Bool, ::Bool, ::Bool, ::Bool, ::Base.Pairs{Symbol, typeof(Main.workspace#3.agent_color), Tuple{Symbol}, NamedTuple{(:ac,), Tuple{typeof(Main.workspace#3.agent_color)}}}, ::typeof(InteractiveDynamics.abmplot!), ::Makie.MakieLayout.Axis, ::Agents.AgentBasedModel{Agents.ContinuousSpace{2, true, Float64, typeof(Agents.defvel)}, Union{Main.workspace#3.Blob, Main.workspace#3.Food}, Agents.Schedulers.Randomly, Dict{Symbol, Int64}, Random.TaskLocalRNG})@abmplot.jl:131</span><span class="w"></span>
<span class="w">    </span><span class="c">#abmplot#29@abmplot.jl:112[inlined]</span><span class="w"></span>
<span class="w">    </span><span class="kt">var</span><span class="s">"#abmexploration#81"</span><span class="p">(</span><span class="o">::</span><span class="kt">Nothing</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="kt">Nothing</span><span class="p">,</span><span class="w"> </span><span class="o">::</span><span class="kt">NamedTuple</span><span class="p">{(),</span><span class="w"> </span><span class="kt">Tuple</span><span class="p">{}},</span><span class="w"> </span><span class="o">::</span><span class="kt">Base</span><span class="o">.</span><span class="kt">Pairs</span><span class="p">{</span><span class="kt">Symbol</span><span class="p">,</span><span class="w"> </span><span class="kt">Any</span><span class="p">,</span><span class="w"> </span><span class="kt">NTuple</span><span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="w"> </span><span class="kt">Symbol</span><span class="p">},</span><span class="w"> </span><span class="kt">NamedTuple</span><span class="p">{(</span><span class="ss">:agent_step!</span><span class="p">,</span><span class="w"> </span><span class="ss">:model_step!</span><span class="p">,</span><span class="w"> </span><span class="ss">:ac</span><span class="p">,</span><span class="w"> </span><span class="ss">:adata</span><span class="p">),</span><span class="w"> </span><span class="kt">Tuple</span><span class="p">{</span><span class="kt">typeof</span><span class="p">(</span><span class="kt">Main</span><span class="o">.</span><span class="kt">workspace</span><span class="c">#3.agent_step!), typeof(Main.workspace#3.model_step!), typeof(Main.workspace#3.agent_color), Vector{Tuple{typeof(Main.workspace#3.energy), typeof(Main.workspace#5.nanmean)}}}}}, ::typeof(InteractiveDynamics.abmexploration), ::Agents.AgentBasedModel{Agents.ContinuousSpace{2, true, Float64, typeof(Agents.defvel)}, Union{Main.workspace#3.Blob, Main.workspace#3.Food}, Agents.Schedulers.Randomly, Dict{Symbol, Int64}, Random.TaskLocalRNG})@convenience.jl:39</span><span class="w"></span>
</code></pre></div>
<p>I didn't manage to find anything with google... and the <code>nanmean</code> method works as intended, if I call it myself. Suggestions?</p>



<a name="288204648"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20Agents.jl%20%22no%20possible%20aggregation%22/near/288204648" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Michael Fiano <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20Agents.2Ejl.20.22no.20possible.20aggregation.22.html#288204648">(Jul 01 2022 at 17:52)</a>:</h4>
<p>I am clueless here but what about <code>missing</code>?</p>



<a name="288205585"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20Agents.jl%20%22no%20possible%20aggregation%22/near/288205585" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lorenzo Gaifas <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20Agents.2Ejl.20.22no.20possible.20aggregation.22.html#288205585">(Jul 01 2022 at 18:00)</a>:</h4>
<p>unfortunately no, because <code>mean([1, missing])</code> is  <code>missing</code>.</p>



<a name="288212872"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20Agents.jl%20%22no%20possible%20aggregation%22/near/288212872" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lorenzo Gaifas <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20Agents.2Ejl.20.22no.20possible.20aggregation.22.html#288212872">(Jul 01 2022 at 19:10)</a>:</h4>
<p>Found out how to solve the issue: use <code>collect(collection)</code> first, because whatever was being passed could not be filtered... gotta learn how to check types more easily :/</p>



<a name="288212877"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20Agents.jl%20%22no%20possible%20aggregation%22/near/288212877" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20Agents.2Ejl.20.22no.20possible.20aggregation.22.html#288212877">(Jul 01 2022 at 19:10)</a>:</h4>
<p><span class="user-mention silent" data-user-id="504808">Lorenzo Gaifas</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Nov 01 2025 at 04:39 UTC</p>
</html>