<html>
<head><meta charset="utf-8"><title>Expensive `length(::AbstractArray)` · helpdesk (published) · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/index.html">helpdesk (published)</a></h2>
<h3>Topic: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html">Expensive `length(::AbstractArray)`</a></h3>

<hr>

<base href="https://julialang.zulipchat.com">

<head><link href="https://juliacommunity.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="403977663"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/403977663" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lilith Hafner <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#403977663">(Nov 24 2023 at 14:29)</a>:</h4>
<p>Does anyone know of an AbstractArray subtype that has an expensive length method? <a href="https://github.com/JuliaLang/julia/pull/52133#issuecomment-1825357138">ref</a></p>



<a name="403978878"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/403978878" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#403978878">(Nov 24 2023 at 14:37)</a>:</h4>
<p>Here's one <img alt=":troll:" class="emoji" src="https://zulip-avatars.s3.amazonaws.com/7178/emoji/images/15252.png" title="troll"> </p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="k">struct</span> <span class="kt">MyArray</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="kt">N</span><span class="p">}</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AbstractVector</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="kt">N</span><span class="p">}</span>
<span class="w">     </span><span class="n">A</span><span class="o">::</span><span class="kt">Array</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="kt">N</span><span class="p">}</span>
<span class="k">end</span>
<span class="n">Base</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="o">::</span><span class="kt">MyArray</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">sleep</span><span class="p">(</span><span class="mi">10</span><span class="p">);</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">A</span><span class="p">))</span>
<span class="n">Base</span><span class="o">.</span><span class="n">getindex</span><span class="p">(</span><span class="n">a</span><span class="o">::</span><span class="kt">MyArray</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">...</span><span class="p">)</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">getindex</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">i</span><span class="o">...</span><span class="p">)</span>
</code></pre></div>



<a name="403979329"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/403979329" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#403979329">(Nov 24 2023 at 14:40)</a>:</h4>
<p>More seriously, I doubt there are many cases where the length is expensive</p>



<a name="403979396"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/403979396" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#403979396">(Nov 24 2023 at 14:40)</a>:</h4>
<p>but it's not hard to dream up such cases</p>



<a name="403979448"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/403979448" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#403979448">(Nov 24 2023 at 14:40)</a>:</h4>
<p>so I don't really see the harm in trying to avoid calling it twice if possible</p>



<a name="404058464"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404058464" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Timothy <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404058464">(Nov 25 2023 at 05:14)</a>:</h4>
<p>A linked list type?</p>



<a name="404096282"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404096282" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404096282">(Nov 25 2023 at 10:49)</a>:</h4>
<p>it'd be kinda weird to make a linked list an <code>AbstractArray</code>, but people do crazy stuff</p>



<a name="404096400"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404096400" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sukera <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404096400">(Nov 25 2023 at 10:50)</a>:</h4>
<p>there are no big-O requirements on the <code>AbstractArray</code> interface <img alt=":shrugging:" class="emoji" src="https://zulip-avatars.s3.amazonaws.com/7178/emoji/images/15207.gif" title="shrugging"></p>



<a name="404096487"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404096487" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404096487">(Nov 25 2023 at 10:51)</a>:</h4>
<p>yep</p>



<a name="404096723"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404096723" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404096723">(Nov 25 2023 at 10:53)</a>:</h4>
<p>I guess some real examples out in the ecosystem would be stuff like <a href="https://github.com/JuliaArrays/LazyArrays.jl#concatenation">https://github.com/JuliaArrays/LazyArrays.jl#concatenation</a> and <a href="https://github.com/JuliaArrays/LazyArrays.jl#kronecker-products">https://github.com/JuliaArrays/LazyArrays.jl#kronecker-products</a></p>



<a name="404096824"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404096824" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404096824">(Nov 25 2023 at 10:53)</a>:</h4>
<p>they're not particularly expensive to compute, but can become arbitrarily expensive through nesting</p>



<a name="404096979"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404096979" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sukera <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404096979">(Nov 25 2023 at 10:54)</a>:</h4>
<p>there's also distributed arrays, with <code>O(does your network like you today)</code></p>



<a name="404097505"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404097505" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404097505">(Nov 25 2023 at 10:59)</a>:</h4>
<div class="codehilite" data-code-language="Julia console"><pre><span></span><code><span class="gp">julia&gt;</span><span class="w"> </span><span class="k">using</span><span class="w"> </span><span class="n">LazyArrays</span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="k">let</span>
<span class="w">           </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">foldl</span><span class="p">(</span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span><span class="p">,</span><span class="w"> </span><span class="n">init</span><span class="o">=</span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">_</span>
<span class="w">               </span><span class="n">ApplyArray</span><span class="p">(</span><span class="n">kron</span><span class="p">,</span><span class="w"> </span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">rand</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">))</span>
<span class="w">           </span><span class="k">end</span>
<span class="w">           </span><span class="nd">@benchmark</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="o">$</span><span class="n">A</span><span class="p">)</span>
<span class="w">       </span><span class="k">end</span>
<span class="go">BenchmarkTools.Trial: 10000 samples with 10 evaluations.</span>
<span class="go"> Range (min … max):  1.143 μs …  2.572 μs  ┊ GC (min … max): 0.00% … 0.00%</span>
<span class="go"> Time  (median):     1.195 μs              ┊ GC (median):    0.00%</span>
<span class="go"> Time  (mean ± σ):   1.211 μs ± 74.610 ns  ┊ GC (mean ± σ):  0.00% ± 0.00%</span>

<span class="go">    ▁▆█▆▄▂</span>
<span class="go">  ▁▂████████▆▅▄▃▃▂▂▁▂▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁ ▂</span>
<span class="go">  1.14 μs        Histogram: frequency by time        1.62 μs &lt;</span>

<span class="go"> Memory estimate: 1.73 KiB, allocs estimate: 46.</span>
</code></pre></div>



<a name="404098271"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404098271" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404098271">(Nov 25 2023 at 11:04)</a>:</h4>
<p>though to be fair, this really doesn't need to be so slow and they could have made it less slow</p>



<a name="404098637"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404098637" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404098637">(Nov 25 2023 at 11:07)</a>:</h4>
<p>ah okay, well if you just construct it using a flat structure instead of nesting like a psychopath, it's just <code>O(number of arrays)</code>, but still.</p>



<a name="404098701"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404098701" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404098701">(Nov 25 2023 at 11:07)</a>:</h4>
<div class="codehilite" data-code-language="Julia console"><pre><span></span><code><span class="gp">julia&gt;</span><span class="w"> </span><span class="k">let</span>
<span class="w">           </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ApplyArray</span><span class="p">(</span><span class="n">kron</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">∈</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">10</span><span class="p">)</span><span class="o">...</span><span class="p">)</span>
<span class="w">           </span><span class="nd">@benchmark</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="o">$</span><span class="n">A</span><span class="p">)</span>
<span class="w">       </span><span class="k">end</span>
<span class="go">BenchmarkTools.Trial: 10000 samples with 1000 evaluations.</span>
<span class="go"> Range (min … max):  6.261 ns … 14.106 ns  ┊ GC (min … max): 0.00% … 0.00%</span>
<span class="go"> Time  (median):     6.272 ns              ┊ GC (median):    0.00%</span>
<span class="go"> Time  (mean ± σ):   6.352 ns ±  0.197 ns  ┊ GC (mean ± σ):  0.00% ± 0.00%</span>

<span class="go">  █▆    ▁▅▅▅▁                               ▃▃               ▂</span>
<span class="go">  ██▄▄▄▃█████▇▄▁▅█▇▁▁▁▃▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▁▇▆▁▁███▇▅▆▁▅▇█▆▁▁▁▁▄█ █</span>
<span class="go">  6.26 ns      Histogram: log(frequency) by time     7.09 ns &lt;</span>

<span class="go"> Memory estimate: 0 bytes, allocs estimate: 0.</span>

<span class="gp">julia&gt;</span><span class="w"> </span><span class="k">let</span>
<span class="w">           </span><span class="n">A</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ApplyArray</span><span class="p">(</span><span class="n">kron</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">rand</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">∈</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="mi">20</span><span class="p">)</span><span class="o">...</span><span class="p">)</span>
<span class="w">           </span><span class="nd">@benchmark</span><span class="w"> </span><span class="n">length</span><span class="p">(</span><span class="o">$</span><span class="n">A</span><span class="p">)</span>
<span class="w">       </span><span class="k">end</span>
<span class="go">BenchmarkTools.Trial: 10000 samples with 999 evaluations.</span>
<span class="go"> Range (min … max):  11.854 ns … 15.595 ns  ┊ GC (min … max): 0.00% … 0.00%</span>
<span class="go"> Time  (median):     11.995 ns              ┊ GC (median):    0.00%</span>
<span class="go"> Time  (mean ± σ):   12.084 ns ±  0.193 ns  ┊ GC (mean ± σ):  0.00% ± 0.00%</span>

<span class="go">      ▅█ ▁▆▄▂                                       ▂ ▃▁</span>
<span class="go">  ▂▃▅████████▇▅▃▁▄▄▃▃▂▂▂▂▂▂▂▂▂▂▁▂▃▄▅▆▅▁▅▆▅▅▅▆▆▃▅▃▄▄▇█▄██▄▄▃▃▂ ▄</span>
<span class="go">  11.9 ns         Histogram: frequency by time        12.4 ns &lt;</span>

<span class="go"> Memory estimate: 0 bytes, allocs estimate: 0.</span>
</code></pre></div>



<a name="404100052"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404100052" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sukera <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404100052">(Nov 25 2023 at 11:18)</a>:</h4>
<p>well, turns out <code>DArray</code>s aren't resizeable, which makes their <code>length</code> a trivial <code>O(1)</code></p>



<a name="404123643"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404123643" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Chen <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404123643">(Nov 25 2023 at 16:21)</a>:</h4>
<p><span class="user-mention silent" data-user-id="269150">Mason Protter</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60/near/404096282">said</a>:</p>
<blockquote>
<p>it'd be kinda weird to make a linked list an <code>AbstractArray</code>, but people do crazy stuff</p>
</blockquote>
<p>A real-world example of this is LinkedList implementing the List API in Java</p>



<a name="404123660"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404123660" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Chen <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404123660">(Nov 25 2023 at 16:21)</a>:</h4>
<p>O(N) random access and all</p>



<a name="404137399"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404137399" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404137399">(Nov 25 2023 at 18:30)</a>:</h4>
<p>Sure, but is it an AbstractArray?</p>



<a name="404140358"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404140358" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Chen <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404140358">(Nov 25 2023 at 18:51)</a>:</h4>
<p>java.util.List is pretty close to AbstractVector. And funnily enough the old Vector class was retrofitted to implement the List interface</p>



<a name="404142690"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404142690" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Timothy <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404142690">(Nov 25 2023 at 19:05)</a>:</h4>
<p><span class="user-mention silent" data-user-id="269150">Mason Protter</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60/near/404096282">said</a>:</p>
<blockquote>
<p>it'd be kinda weird to make a linked list an <code>AbstractArray</code>, but people do crazy stuff</p>
</blockquote>
<p>I don't see what aspect of the Array API would be violated.</p>



<a name="404156736"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404156736" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404156736">(Nov 25 2023 at 20:45)</a>:</h4>
<p>None of it</p>



<a name="404171552"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404171552" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Hanson <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404171552">(Nov 25 2023 at 22:59)</a>:</h4>
<p>I don’t think abstract array is a very useful concept to write performant algorithms against if one isn’t assuming O(1) random access and length checks. If it’s easy to avoid such assumptions I don’t see why not but I don’t really think one needs to go out of their way too far for it.</p>



<a name="404172492"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404172492" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404172492">(Nov 25 2023 at 23:13)</a>:</h4>
<p>Yeah. Ultimately, when people write methods targeting <code>AbstractArray</code>, regular <code>Array</code> is their first consideration, and any different subtype comes secondary.</p>



<a name="404172563"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404172563" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404172563">(Nov 25 2023 at 23:14)</a>:</h4>
<p><code>Array</code> is the defacto standard, but you're allowed to create subtypes that deviate from <code>Array</code>'s behaviour in pretty wild ways, with the implicit understanding that the further you deviate, the more likely it is that something will go wrong</p>



<a name="404174134"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404174134" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Chen <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404174134">(Nov 25 2023 at 23:41)</a>:</h4>
<p>I wish there was a better and more scalable way of nudging people away from writing code which promises to take AbstractArrays but only really works for Array. Even measures such as asking for functions to add guards like <code>Base.require_one_based_indexing</code> seem to be a bridge too far :(</p>



<a name="404176106"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404176106" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> jar <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404176106">(Nov 26 2023 at 00:10)</a>:</h4>
<p><code>function f(::Array)</code>?</p>



<a name="404260126"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404260126" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brenhin Keller <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404260126">(Nov 26 2023 at 13:50)</a>:</h4>
<p><span class="user-mention silent" data-user-id="278065">Brian Chen</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60/near/404174134">said</a>:</p>
<blockquote>
<p>I wish there was a better and more scalable way of nudging people away from writing code which promises to take AbstractArrays but only really works for Array. Even measures such as asking for functions to add guards like <code>Base.require_one_based_indexing</code> seem to be a bridge too far :(</p>
</blockquote>
<p>I just write my methods for <code>::DenseArray</code> rather than <code>::AbstractArray</code> if I want to be able to assume one-based indexing, and have been happy with that</p>



<a name="404263048"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404263048" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lilith Hafner <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404263048">(Nov 26 2023 at 14:27)</a>:</h4>
<p>Are <code>DenseArray</code>s guarunteed to have one-based indexing?</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="n">help</span><span class="o">?&gt;</span><span class="w"> </span><span class="kt">DenseArray</span>
<span class="n">search</span><span class="o">:</span><span class="w"> </span><span class="kt">DenseArray</span><span class="w"> </span><span class="kt">DenseMatrix</span>

<span class="w">  </span><span class="kt">DenseArray</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="w"> </span><span class="kt">N</span><span class="p">}</span><span class="w"> </span><span class="o">&lt;:</span><span class="w"> </span><span class="kt">AbstractArray</span><span class="p">{</span><span class="kt">T</span><span class="p">,</span><span class="kt">N</span><span class="p">}</span>

<span class="w">  </span><span class="n">N</span><span class="o">-</span><span class="n">dimensional</span><span class="w"> </span><span class="n">dense</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">with</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">type</span><span class="w"> </span><span class="n">T</span><span class="o">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">elements</span><span class="w"> </span><span class="n">of</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">dense</span><span class="w"> </span><span class="n">array</span><span class="w"> </span><span class="n">are</span><span class="w"> </span><span class="n">stored</span><span class="w"> </span><span class="n">contiguously</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="n">memory</span><span class="o">.</span>
</code></pre></div>



<a name="404265221"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404265221" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sukera <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404265221">(Nov 26 2023 at 14:54)</a>:</h4>
<p>they are not</p>



<a name="404265363"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404265363" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404265363">(Nov 26 2023 at 14:56)</a>:</h4>
<p>These days I mostly think that offset arrays were a bad idea. We should have just demanded that abstract arrays do <code>1</code>-based indexing, and then purused offset index types, rather than offset array types.</p>



<a name="404265373"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404265373" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404265373">(Nov 26 2023 at 14:56)</a>:</h4>
<p>hindsight is 20/20 though</p>



<a name="404272023"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404272023" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Chen <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404272023">(Nov 26 2023 at 16:25)</a>:</h4>
<p>I argued something similar on Slack the other day. That said, I think this goes beyond index bases. For example, functions assuming their array inputs are mutable or that setindex! will work over the entire index range of the array.</p>



<a name="404272165"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404272165" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404272165">(Nov 26 2023 at 16:27)</a>:</h4>
<p>yep</p>



<a name="404272410"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404272410" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404272410">(Nov 26 2023 at 16:31)</a>:</h4>
<p>I do think though that the whole offset-array thing is one of the biggest offenders for <code>AbstractArray</code> problems. In particular, I'm pretty sure it's by far the worst for causing people to get silently incorrect results rather than errors, either because <code>@inbounds</code> was misused, or because the whole array wasn't indexed over (e.g. <code>arr[1:5]</code> or whatever)</p>



<a name="404272507"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404272507" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404272507">(Nov 26 2023 at 16:33)</a>:</h4>
<p>Getting a <code>MethodError</code> because your program tried to do <code>setindex!</code> but that wasn't supported is pretty benign by comparison.</p>



<a name="404272864"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404272864" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404272864">(Nov 26 2023 at 16:38)</a>:</h4>
<p>It's a big mental drain because a lot of the time, I'll write a function, and it's a perfectly fine <code>AbstractArray</code> function, except for the fact that it assumes 1-based indexing, so then I need to decide. Do I</p>
<ol>
<li>fix it to use arbitrary indexing? that's sometimes easy and sometimes pretty annoying</li>
<li>constraint it to only take <code>Array</code>? Fine, but what if I want to use views, or <code>Adjoint</code> or whatever</li>
<li>add a <code>Base.require_one_based_indexing</code>, I guess, but that's also just a kinda ugly kludge.</li>
</ol>
<p>It's not a big deal, and usually there is a good solution from that list, but I don't like that I need to make that decision every time I encounter this, when it really could have just been solved once and for all by demanding 1-based indexing when you pass an <code>Integer</code> or <code>CartesianIndex</code>.</p>



<a name="404272883"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404272883" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Timothy <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404272883">(Nov 26 2023 at 16:39)</a>:</h4>
<p>Isn't there some wrapper type that makes one based indexing apply? I have a vague recollection.</p>



<a name="404272972"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404272972" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404272972">(Nov 26 2023 at 16:40)</a>:</h4>
<p>Welcome to array wrapper hell</p>



<a name="404272981"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404272981" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404272981">(Nov 26 2023 at 16:40)</a>:</h4>
<p>I don't recommend it.</p>



<a name="404273142"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404273142" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404273142">(Nov 26 2023 at 16:43)</a>:</h4>
<p>The easiest way to wrap your way out of it would be to just use another <code>OffsetArray</code>, i.e.</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="n">OffsetArray</span><span class="p">(</span><span class="n">A</span><span class="p">,</span><span class="w"> </span><span class="n">map</span><span class="p">(</span><span class="n">s</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="mi">1</span><span class="o">:</span><span class="n">s</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">A</span><span class="p">)))</span>
</code></pre></div>
<p>but that's yet another unpleasant kldugy solution</p>



<a name="404275781"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404275781" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> aplavin <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404275781">(Nov 26 2023 at 17:24)</a>:</h4>
<p>Note that one shouldn't blindly turn offsetarrays into 1-indexed ones in the function, and claim "now my code supports offsetarrays". Different indices is the actual reason to use offsetarrays in the first place! For some functions ignoring indices is fine, for many it isn't.<br>
For example, <code>fft(offsetarray)</code> is different from <code>fft(1-array with the same data)</code>.<br>
Or, <code>cor(A::AbstractArray, B::AbstractArray) = cor(collect(A), collect(B))</code> method if it existed would be wrong for offsetarrays.</p>



<a name="404277761"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404277761" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Chen <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404277761">(Nov 26 2023 at 17:55)</a>:</h4>
<p><span class="user-mention silent" data-user-id="269150">Mason Protter</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60/near/404272864">said</a>:</p>
<blockquote>
<ol start="2">
<li>constraint it to only take <code>Array</code>? Fine, but what if I want to use views, or <code>Adjoint</code> or whatever</li>
</ol>
</blockquote>
<p>This is what makes me wonder if <code>Array</code> shouldn't have been more like <code>StrideArray</code> and internalized some of this information instead of relying on wrappers and crazy unions like <code>StridedArray</code></p>



<a name="404278282"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404278282" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brian Chen <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404278282">(Nov 26 2023 at 17:58)</a>:</h4>
<p><span class="user-mention silent" data-user-id="269150">Mason Protter</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60/near/404272507">said</a>:</p>
<blockquote>
<p>Getting a <code>MethodError</code> because your program tried to do <code>setindex!</code> but that wasn't supported is pretty benign by comparison.</p>
</blockquote>
<p>Was thinking more of a case where e.g. an in-place function assumes it can re-use parts of the output as scratch space, but then it gets passed a wrapper type like <code>Diagonal</code> and throws an ArgumentError trying to <code>setindex!</code> where it's not allowed to. This example is a little contrived, but I feel like similar issues have shown up in the wild beofre.</p>



<a name="404283777"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404283777" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Brenhin Keller <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404283777">(Nov 26 2023 at 19:27)</a>:</h4>
<p><span class="user-mention silent" data-user-id="669432">Lilith Hafner</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60/near/404263048">said</a>:</p>
<blockquote>
<p>Are <code>DenseArray</code>s guarunteed to have one-based indexing?</p>
</blockquote>
<p>Oh I may be getting confused with column-major, which they are documented as being (despite that not being in the docstring): <a href="https://github.com/JuliaLang/julia/blob/c30d45dfdf63c83eb864ebe924a715fe283013b4/doc/src/manual/arrays.md?plain=1#L1124C1-L1131C1">https://github.com/JuliaLang/julia/blob/c30d45dfdf63c83eb864ebe924a715fe283013b4/doc/src/manual/arrays.md?plain=1#L1124C1-L1131C1</a></p>
<p>IMO if they're not, it might be worth  requiring them or a subtype to be one-based too, since it might be useful to have that information in the type system</p>



<a name="404283966"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404283966" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Sukera <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404283966">(Nov 26 2023 at 19:30)</a>:</h4>
<blockquote>
<p>much of the array library is implemented in a generic manner that allows all custom arrays to behave similarly.</p>
</blockquote>
<p><span aria-label="rolling on the floor laughing" class="emoji emoji-1f923" role="img" title="rolling on the floor laughing">:rolling_on_the_floor_laughing:</span></p>



<a name="404294640"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404294640" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Lilith Hafner <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404294640">(Nov 26 2023 at 22:14)</a>:</h4>
<p>It would not be breaking to add a <code>OneBasedAbstractArray &lt;: AbstractArray</code>, but then things like <code>SubArray</code> would need to either 1) not subtype <code>OneBasedAbstractArray</code> or 2) split into <code>OneBasedSubArray &lt;: SubArray</code>.</p>
<p><a href="https://github.com/JuliaLang/julia/issues/5">#5</a> would be the best solution. Non-dispatchable traits would be sufficient in this case and wouldn't have any of the ambiguity issues</p>



<a name="404296094"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404296094" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404296094">(Nov 26 2023 at 22:39)</a>:</h4>
<p><span class="user-mention silent" data-user-id="278065">Brian Chen</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60/near/404277761">said</a>:</p>
<blockquote>
<p><span class="user-mention silent" data-user-id="269150">Mason Protter</span> <a href="#narrow/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60/near/404272864">said</a>:</p>
<blockquote>
<ol start="2">
<li>constraint it to only take <code>Array</code>? Fine, but what if I want to use views, or <code>Adjoint</code> or whatever</li>
</ol>
</blockquote>
<p>This is what makes me wonder if <code>Array</code> shouldn't have been more like <code>StrideArray</code> and internalized some of this information instead of relying on wrappers and crazy unions like <code>StridedArray</code></p>
</blockquote>
<p>It's a difficult trade off. <code>StrideArray</code> has a million different opaque, undocumented type parameters that mean different things about the array. It certainly has really nice properties, but it does come at a cost to comprehension</p>



<a name="404296147"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Expensive%20%60length%28%3A%3AAbstractArray%29%60/near/404296147" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/Expensive.20.60length.28.3A.3AAbstractArray.29.60.html#404296147">(Nov 26 2023 at 22:40)</a>:</h4>
<p>But I really do think the current situation with array wrappers is borderline intolerable.</p>



<hr><p>Last updated: Mar 02 2026 at 05:32 UTC</p>
</html>