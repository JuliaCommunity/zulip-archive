<html>
<head><meta charset="utf-8"><title>✔ World age advance in tests · helpdesk (published) · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/index.html">helpdesk (published)</a></h2>
<h3>Topic: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20World.20age.20advance.20in.20tests.html">✔ World age advance in tests</a></h3>

<hr>

<base href="https://julialang.zulipchat.com">

<head><link href="https://juliacommunity.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="558701891"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20World%20age%20advance%20in%20tests/near/558701891" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DrChainsaw <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20World.20age.20advance.20in.20tests.html#558701891">(Nov 21 2025 at 16:25)</a>:</h4>
<p>I have a testset for some code generation code which used to work in 1.11 but now fails in 1.12. I realize it might have worked for the wrong reasons before, but I guess now is as good a time to fix it as ever.</p>
<p>The overall structure of the test is like this</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="nd">@testset</span><span class="w"> </span><span class="s">"Test Concept XX"</span><span class="w"> </span><span class="k">begin</span>
<span class="w">     </span><span class="c"># Do some setup</span>
<span class="w">     </span><span class="nd">@eval</span><span class="w"> </span><span class="k">module</span><span class="w"> </span><span class="n">TestModule</span><span class="w"> </span><span class="k">end</span><span class="w"> </span><span class="c"># Code will be generated into this module to not mess up other modules (eg Main)</span>

<span class="w">       </span><span class="nd">@testset</span><span class="w"> </span><span class="s">"Test generation of </span><span class="si">$x</span><span class="s">"</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="p">(</span><span class="o">....</span><span class="p">)</span>
<span class="w">            </span><span class="k">try</span>
<span class="w">                </span><span class="c"># Test that user gets a nice warning if they ever end up doing this</span>
<span class="w">                 </span><span class="k">function</span><span class="w"> </span><span class="n">badfun</span><span class="p">()</span>
<span class="w">                         </span><span class="n">generate_code!</span><span class="p">(</span><span class="n">TestModule</span><span class="p">,</span><span class="w"> </span><span class="n">x</span><span class="p">)</span>
<span class="w">                         </span><span class="c"># Call code which uses result of  the above</span>
<span class="w">                         </span><span class="n">make_use_of_generated_stuff</span><span class="p">(</span><span class="n">TestModule</span><span class="p">)</span>
<span class="w">                 </span><span class="k">end</span>

<span class="w">                </span><span class="nd">@test_logs</span><span class="w"> </span><span class="p">(</span><span class="ss">:warn</span><span class="p">,</span><span class="w"> </span><span class="s">"Warning about generated code"</span><span class="p">)</span><span class="w"> </span><span class="n">badfun</span><span class="p">()</span>
<span class="w">                </span><span class="c"># In Julia 1.11 it seems the world age had advanced here, but in 1.12 it hasn't</span>
<span class="w">                 </span><span class="nd">@test</span><span class="w"> </span><span class="n">make_use_of_generated_stuff</span><span class="p">(</span><span class="n">TestModule</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected_result</span>

<span class="w">            </span><span class="k">finally</span>
<span class="w">                  </span><span class="n">clear_some_global_caches_in_tested_package</span><span class="p">()</span>
<span class="w">            </span><span class="k">end</span>
<span class="w">       </span><span class="k">end</span>
<span class="k">end</span>
</code></pre></div>
<p>The above is in a file which is included from runtests.jl inside another testcase:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="nd">@testset</span><span class="w"> </span><span class="s">"Test Concepts"</span><span class="w"> </span><span class="k">begin</span>
<span class="w">        </span><span class="n">include</span><span class="p">(</span><span class="s">"the/above/file.jl"</span><span class="p">)</span>
<span class="k">end</span>
</code></pre></div>
<p>Is there any place in this where it is safe to assume that the world age has advanced in 1.12?</p>



<a name="558702934"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20World%20age%20advance%20in%20tests/near/558702934" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Eric Hanson <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20World.20age.20advance.20in.20tests.html#558702934">(Nov 21 2025 at 16:29)</a>:</h4>
<p><a href="https://docs.julialang.org/en/v1/base/base/#include">https://docs.julialang.org/en/v1/base/base/#include</a> mentions <code>Core.@latestworld</code>, but <code>Core.@latestworld</code> itself doesn't have docs. But it sounds like placing that where you want the world age to advance might work?</p>



<a name="558711114"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20World%20age%20advance%20in%20tests/near/558711114" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20World.20age.20advance.20in.20tests.html#558711114">(Nov 21 2025 at 17:05)</a>:</h4>
<p>You can just use <code>invokelatest</code> too, right?</p>



<a name="558714240"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20World%20age%20advance%20in%20tests/near/558714240" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> DrChainsaw <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20World.20age.20advance.20in.20tests.html#558714240">(Nov 21 2025 at 17:23)</a>:</h4>
<p>Thanks alot. Both Core.@latestworld and invokelatest worked. I guess invokelatest will also work on earlier versions and I think it is enough for the test to be valid (or else it was not a good test to begin with).</p>



<a name="558714263"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/%E2%9C%94%20World%20age%20advance%20in%20tests/near/558714263" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Notification Bot <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-.28published.29/topic/.E2.9C.94.20World.20age.20advance.20in.20tests.html#558714263">(Nov 21 2025 at 17:23)</a>:</h4>
<p><span class="user-mention silent" data-user-id="300483">DrChainsaw</span> has marked this topic as resolved.</p>



<hr><p>Last updated: Mar 02 2026 at 05:32 UTC</p>
</html>