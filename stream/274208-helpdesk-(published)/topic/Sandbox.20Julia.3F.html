<html>
<head><meta charset="utf-8"><title>Sandbox Julia? · helpdesk (published) · Zulip Chat Archive</title></head>
<h2>Stream: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/index.html">helpdesk (published)</a></h2>
<h3>Topic: <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html">Sandbox Julia?</a></h3>

<hr>

<base href="https://julialang.zulipchat.com">

<head><link href="https://juliacommunity.github.io/zulip-archive/style.css" rel="stylesheet"></head>

<a name="228078519"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078519" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078519">(Feb 27 2021 at 19:40)</a>:</h4>
<p>I'd like to be able to have an environment where only symbols I specify are defined.</p>
<p>This is for an educational purpose where I want to define <br>
E.g. an environment with only a <code>nand(a, b)</code> function and then the user is expected to define a bunch of combinatorial logic from that.</p>



<a name="228078662"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078662" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078662">(Feb 27 2021 at 19:44)</a>:</h4>
<p>Have you looked into <code>baremodule</code>?</p>



<a name="228078674"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078674" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078674">(Feb 27 2021 at 19:44)</a>:</h4>
<p>Yeah, but it still imports too much.</p>



<a name="228078699"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078699" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078699">(Feb 27 2021 at 19:45)</a>:</h4>
<p>How is the user meant to interact with Julia?</p>



<a name="228078704"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078704" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078704">(Feb 27 2021 at 19:45)</a>:</h4>
<p>It sounds like maybe you just should make a little DSL</p>



<a name="228078782"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078782" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078782">(Feb 27 2021 at 19:47)</a>:</h4>
<p>The idea was to just get Julia semantics but with a clean slate that doesn't contain any of Core or Base.</p>
<p>Behind the scenes, they're still there, but the user can only interact with the names I give them or that they define themselves.</p>



<a name="228078836"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078836" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078836">(Feb 27 2021 at 19:48)</a>:</h4>
<p>Maybe I can just build some machinery that tracks what symbols are in use and an eval that errors if you use any "undefined" symbol.</p>



<a name="228078837"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078837" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078837">(Feb 27 2021 at 19:48)</a>:</h4>
<p>Again, how is the user meant to interact? repl? Some input box on a website?</p>



<a name="228078844"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078844" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078844">(Feb 27 2021 at 19:48)</a>:</h4>
<p><span class="user-mention silent" data-user-id="274427">Colin Caine</span> <a href="#narrow/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F/near/228078836">said</a>:</p>
<blockquote>
<p>Maybe I can just build some machinery that tracks what symbols are in use and an eval that errors if you use any "undefined" symbol.</p>
</blockquote>
<p>yeah, that's what I meant by a "little dsl"</p>



<a name="228078939"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228078939" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228078939">(Feb 27 2021 at 19:50)</a>:</h4>
<p>As for input, files and a REPL.</p>



<a name="228079427"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228079427" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228079427">(Feb 27 2021 at 20:00)</a>:</h4>
<p>What names are in a baremodule that you don't want? I think you might be able to get away with just using a baremodule and then having a blacklist for the remaining names, e.g. <code>Core</code> and <code>eval</code></p>



<a name="228080756"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228080756" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228080756">(Feb 27 2021 at 20:23)</a>:</h4>
<p>I think I'd just want to expose <code>nand(a, b)</code>, <code>true</code> and <code>false</code>. And all of the string and number literals would be absent.</p>
<p>Small languages are used a lot in some programming courses (e.g. Beginner's Student Language defined in racket), though I'm not sure one as basic as I'm suggesting would actually be helpful :)</p>



<a name="228080897"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228080897" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228080897">(Feb 27 2021 at 20:25)</a>:</h4>
<p>Anyway, this doesn't seem super hard, maybe I'll just build something and see if it's easy and useful.</p>



<a name="228082036"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082036" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082036">(Feb 27 2021 at 20:44)</a>:</h4>
<p>Okay, here's a demo with <a href="https://github.com/search?q=ReplMaker.jl&amp;type=Repositories">ReplMaker.jl</a> that I think works:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="k">using</span> <span class="n">ReplMaker</span><span class="p">,</span> <span class="n">MLStyle</span>

<span class="k">baremodule</span> <span class="n">Sandbox</span> <span class="k">end</span>
<span class="nd">@eval</span> <span class="n">Sandbox</span> <span class="n">nand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="o">$</span><span class="p">(</span><span class="o">!</span><span class="p">)(</span><span class="o">$</span><span class="p">(</span><span class="o">&amp;</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="k">function</span> <span class="n">sandbox_parser</span><span class="p">(</span><span class="n">s</span><span class="o">::</span><span class="n">String</span><span class="p">)</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">Meta</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">filterer</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="o">=</span> <span class="nd">@match</span> <span class="n">ex</span> <span class="k">begin</span>
        <span class="o">:</span><span class="n">Core</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"that's not allowed"</span><span class="p">)</span>
        <span class="o">:</span><span class="n">eval</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"that's not allowed"</span><span class="p">)</span>
        <span class="n">x</span><span class="o">::</span><span class="kt">Bool</span> <span class="o">=&gt;</span> <span class="n">x</span>
        <span class="o">::</span><span class="kt">Number</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"that's not allowed"</span><span class="p">)</span>
        <span class="o">::</span><span class="n">String</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"that's not allowed"</span><span class="p">)</span>
        <span class="o">::</span><span class="kt">AbstractArray</span> <span class="o">=&gt;</span> <span class="n">println</span><span class="p">(</span><span class="s">"that's not allowed"</span><span class="p">)</span>
        <span class="n">x</span><span class="o">::</span><span class="kt">Expr</span> <span class="o">=&gt;</span> <span class="kt">Expr</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">head</span><span class="p">,</span> <span class="n">filterer</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">)</span><span class="o">...</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=&gt;</span> <span class="n">x</span>
    <span class="k">end</span>
    <span class="o">:</span><span class="p">(</span><span class="nd">@eval</span> <span class="n">Sandbox</span> <span class="o">$</span><span class="p">(</span><span class="n">filterer</span><span class="p">(</span><span class="n">ex</span><span class="p">)))</span>
<span class="k">end</span>


<span class="k">function</span> <span class="n">valid_julia</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">take!</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">ReplMaker</span><span class="o">.</span><span class="n">LineEdit</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">s</span><span class="p">))))</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">Meta</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ex</span> <span class="kp">isa</span> <span class="kt">Expr</span> <span class="o">&amp;&amp;</span> <span class="n">ex</span><span class="o">.</span><span class="n">head</span> <span class="o">==</span> <span class="o">:</span><span class="n">incomplete</span>
        <span class="kc">false</span>
    <span class="k">else</span>
        <span class="kc">true</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="n">sandbox_mode</span> <span class="o">=</span> <span class="n">initrepl</span><span class="p">(</span><span class="n">sandbox_parser</span><span class="p">;</span>
                        <span class="n">prompt_text</span><span class="o">=</span><span class="s">"Sandbox&gt; "</span><span class="p">,</span>
                        <span class="n">prompt_color</span> <span class="o">=</span> <span class="o">:</span><span class="n">yellow</span><span class="p">,</span>
                        <span class="n">startup_text</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
                        <span class="n">mode_name</span> <span class="o">=</span> <span class="o">:</span><span class="n">sandbox</span><span class="p">,</span>
                        <span class="n">valid_input_checker</span> <span class="o">=</span> <span class="n">valid_julia</span><span class="p">)</span>

<span class="n">enter_mode!</span><span class="p">(</span><span class="n">sandbox_mode</span><span class="p">)</span>
</code></pre></div>



<a name="228082174"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082174" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082174">(Feb 27 2021 at 20:47)</a>:</h4>
<p>if you run that, you'll find yourself in the <code>sandbox&gt; </code> prompt and then you can run various stuff:</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="n">Sandbox</span><span class="o">&gt;</span> <span class="n">t</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span> <span class="n">f</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="n">Sandbox</span><span class="o">&gt;</span> <span class="n">nand</span><span class="p">(</span><span class="n">t</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
<span class="kc">false</span>

<span class="n">Sandbox</span><span class="o">&gt;</span> <span class="n">nand</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
<span class="kc">true</span>

<span class="n">Sandbox</span><span class="o">&gt;</span> <span class="n">not</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">=</span> <span class="n">nand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">true</span><span class="p">)</span>
<span class="n">not</span> <span class="p">(</span><span class="n">generic</span> <span class="k">function</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">method</span><span class="p">)</span>

<span class="n">Sandbox</span><span class="o">&gt;</span> <span class="n">and</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="n">not</span><span class="p">(</span><span class="n">nand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
<span class="n">and</span> <span class="p">(</span><span class="n">generic</span> <span class="k">function</span> <span class="n">with</span> <span class="mi">1</span> <span class="n">method</span><span class="p">)</span>

<span class="n">Sandbox</span><span class="o">&gt;</span> <span class="n">and</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="kc">true</span>

<span class="n">Sandbox</span><span class="o">&gt;</span> <span class="mi">1</span>
<span class="n">that</span><span class="o">'</span><span class="n">s</span> <span class="n">not</span> <span class="n">allowed</span>
</code></pre></div>



<a name="228082370"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082370" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082370">(Feb 27 2021 at 20:51)</a>:</h4>
<p>That's very neat. I was thinking I would have to do some name mangling as well as pattern matching</p>



<a name="228082482"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082482" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082482">(Feb 27 2021 at 20:53)</a>:</h4>
<p>One potential issue is that they can always just hit the backspace button to exit the prompt and then do whatever they want</p>



<a name="228082539"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082539" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082539">(Feb 27 2021 at 20:54)</a>:</h4>
<p>but I think you could delve into <code>sandbox_mode.keymap_dict</code> and potentially remove that ability? I'm not sure.</p>



<a name="228082573"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082573" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082573">(Feb 27 2021 at 20:55)</a>:</h4>
<p>Maybe safer would be to just make your own barebones repl that they can't escape from?</p>



<a name="228082624"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082624" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082624">(Feb 27 2021 at 20:56)</a>:</h4>
<p><a href="https://github.com/hanslub42/rlwrap">https://github.com/hanslub42/rlwrap</a> will make it somewhat easy to make your own repl that supports things like history and such</p>



<a name="228082716"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082716" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082716">(Feb 27 2021 at 20:58)</a>:</h4>
<p>Yeah, there's a few other things, like you can still import whatever modules you like, and there's some more tricky security things if I wanted to make a more secure sandbox.</p>
<p>But this is a very nice start, thank you :)</p>



<a name="228082742"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082742" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082742">(Feb 27 2021 at 20:59)</a>:</h4>
<p>Mhm. You'd want to blacklist <code>using</code> and <code>import</code> for sure.</p>



<a name="228082828"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228082828" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228082828">(Feb 27 2021 at 21:00)</a>:</h4>
<p>I wonder if there's a way to remove all the names from <code>Core</code>, but still allow them to be defined, just not used.</p>



<a name="228083482"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228083482" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228083482">(Feb 27 2021 at 21:12)</a>:</h4>
<p>I opened a discourse thread asking if anyone knows a way. <a href="https://discourse.julialang.org/t/even-more-bare-baremodule/56156">https://discourse.julialang.org/t/even-more-bare-baremodule/56156</a></p>



<a name="228083521"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228083521" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Mason Protter <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228083521">(Feb 27 2021 at 21:13)</a>:</h4>
<p>An alternative to a real module would be to repurpose some of the code from <a href="https://github.com/search?q=StaticModules.jl&amp;type=Repositories">StaticModules.jl</a> to make your own custom 'module' that does exactly what you want</p>



<a name="228086578"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228086578" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takafumi Arakaki (tkf) <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228086578">(Feb 27 2021 at 22:16)</a>:</h4>
<p>I guess you'd also need to exclude <code>Main</code>, as otherwise, I can call, e.g., <code>Main.Base.eval</code>.</p>



<a name="228086588"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228086588" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takafumi Arakaki (tkf) <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228086588">(Feb 27 2021 at 22:16)</a>:</h4>
<p>As a related note, I'm somewhat surprised that <code>names(Sandbox; all = true, imported = true)</code> does not output anything.</p>



<a name="228086789"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228086789" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takafumi Arakaki (tkf) <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228086789">(Feb 27 2021 at 22:21)</a>:</h4>
<p>Oh, it also looks like you can <code>ccall</code> inside a <code>baremodule</code> (since it's a syntax).</p>



<a name="228086833"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228086833" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228086833">(Feb 27 2021 at 22:22)</a>:</h4>
<p><code>names(Sandbox)</code> does give output for me on Julia 1.5</p>



<a name="228086972"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228086972" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Takafumi Arakaki (tkf) <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228086972">(Feb 27 2021 at 22:25)</a>:</h4>
<p>Ah, I wasn't accurate. I meant to say an array with more than one element; e.g., I was hoping to see <code>Array</code> etc.</p>



<a name="228087037"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228087037" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228087037">(Feb 27 2021 at 22:26)</a>:</h4>
<p>At least a couple of months ago there were some quite big differences between the output of Meta.parse on 1.5 and 1.6 (with 1.6 giving lowered IR for some things). I wonder if that was ever cleared up.</p>



<a name="228087050"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228087050" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228087050">(Feb 27 2021 at 22:26)</a>:</h4>
<p><span class="user-mention" data-user-id="297129">@Takafumi Arakaki (tkf)</span> ah, gotcha.</p>



<a name="228089098"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228089098" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228089098">(Feb 27 2021 at 23:05)</a>:</h4>
<p>Expanded on <span class="user-mention" data-user-id="269150">@Mason Protter</span>'s example :)</p>
<div class="codehilite" data-code-language="Julia"><pre><span></span><code><span class="k">using</span> <span class="n">ReplMaker</span><span class="p">,</span> <span class="n">MLStyle</span>

<span class="k">baremodule</span> <span class="n">Sandbox</span> <span class="k">end</span>
<span class="nd">@eval</span> <span class="n">Sandbox</span> <span class="n">nand</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="o">=</span> <span class="o">$</span><span class="p">(</span><span class="o">!</span><span class="p">)(</span><span class="o">$</span><span class="p">(</span><span class="o">&amp;</span><span class="p">)(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

<span class="k">function</span> <span class="n">eval_in_sandbox</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
    <span class="n">forbidden_names</span> <span class="o">=</span> <span class="n">setdiff</span><span class="p">(</span><span class="n">names</span><span class="p">(</span><span class="n">Core</span><span class="p">;</span> <span class="n">all</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="n">imported</span><span class="o">=</span><span class="kc">true</span><span class="p">),</span> <span class="n">names</span><span class="p">(</span><span class="n">Sandbox</span><span class="p">;</span> <span class="n">all</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="n">imported</span><span class="o">=</span><span class="kc">true</span><span class="p">))</span>
    <span class="n">filterer</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span> <span class="o">=</span> <span class="nd">@match</span> <span class="n">ex</span> <span class="k">begin</span>
        <span class="n">x</span><span class="o">::</span><span class="kt">Bool</span> <span class="o">=&gt;</span> <span class="n">x</span>

        <span class="n">x</span><span class="o">::</span><span class="kt">LineNumberNode</span> <span class="o">=&gt;</span> <span class="n">x</span>

        <span class="c"># Ban everything.</span>
        <span class="c"># Copy anything you want to allow to above this point.</span>

        <span class="c"># it's a bit complicated to work out when a symbol is being used as a</span>
        <span class="c"># reference and what scope it is in. I think the JuliaVariables people</span>
        <span class="c"># have maybe done something with that?</span>
        <span class="n">s</span><span class="o">::</span><span class="kt">Symbol</span> <span class="o">=&gt;</span> <span class="n">s</span> <span class="kp">in</span> <span class="n">forbidden_names</span> <span class="o">?</span> <span class="n">throw</span><span class="p">(</span><span class="s">"Sorry! You can't use that name in the sandbox"</span><span class="p">)</span> <span class="o">:</span> <span class="n">s</span>

        <span class="c"># Not allowed to import stuff</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="k">using</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="k">import</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">error</span><span class="p">(</span><span class="s">"Imports are not permitted in the sandbox"</span><span class="p">)</span>

        <span class="c"># Julia literals, these are mostly or entirely harmless (I think)</span>
        <span class="c"># but you might want to omit them or rewrite them to something else or whatever.</span>
        <span class="o">::</span><span class="kt">Bool</span> <span class="o">||</span>
        <span class="o">::</span><span class="kt">Number</span> <span class="o">||</span>
        <span class="o">::</span><span class="n">String</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">string</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span> <span class="c"># string interpolation</span>
        <span class="o">::</span><span class="kt">QuoteNode</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="k">quote</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">ref</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span> <span class="c"># a[i], but also Int[]</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">typed_vcat</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">typed_hcat</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">vect</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">vcat</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">hcat</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">tuple</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span> <span class="c"># also covers named tuples</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">comprehension</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">typed_comprehension</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">||</span>
        <span class="kt">Expr</span><span class="p">(</span><span class="o">:</span><span class="n">generator</span><span class="p">,</span> <span class="n">_</span><span class="o">...</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="n">error</span><span class="p">(</span><span class="s">"This literal is not permitted in the sandbox"</span><span class="p">)</span>

        <span class="c"># TODO</span>
        <span class="c"># ccall (!!)</span>

        <span class="c"># Recurse</span>
        <span class="c"># Expr(head, args...) =&gt; Expr(head, filterer.(x.args)...)</span>
        <span class="n">x</span><span class="o">::</span><span class="kt">Expr</span> <span class="o">=&gt;</span> <span class="kt">Expr</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">head</span><span class="p">,</span> <span class="n">filterer</span><span class="o">.</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">args</span><span class="p">)</span><span class="o">...</span><span class="p">)</span>

        <span class="c"># Fallback for other things</span>
        <span class="n">x</span> <span class="o">=&gt;</span> <span class="n">error</span><span class="p">(</span><span class="s">"Unknown thing: </span><span class="si">$x</span><span class="s">"</span><span class="p">)</span>
    <span class="k">end</span>
    <span class="o">:</span><span class="p">(</span><span class="nd">@eval</span> <span class="n">Sandbox</span> <span class="o">$</span><span class="p">(</span><span class="n">filterer</span><span class="p">(</span><span class="n">ex</span><span class="p">)))</span>
<span class="k">end</span>


<span class="k">function</span> <span class="n">sandbox_parser</span><span class="p">(</span><span class="n">s</span><span class="o">::</span><span class="n">String</span><span class="p">)</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">Meta</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">eval_in_sandbox</span><span class="p">(</span><span class="n">ex</span><span class="p">)</span>
<span class="k">end</span>


<span class="k">function</span> <span class="n">valid_julia</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
    <span class="n">input</span> <span class="o">=</span> <span class="n">String</span><span class="p">(</span><span class="n">take!</span><span class="p">(</span><span class="n">copy</span><span class="p">(</span><span class="n">ReplMaker</span><span class="o">.</span><span class="n">LineEdit</span><span class="o">.</span><span class="n">buffer</span><span class="p">(</span><span class="n">s</span><span class="p">))))</span>
    <span class="n">ex</span> <span class="o">=</span> <span class="n">Meta</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">input</span><span class="p">)</span>
    <span class="o">!</span><span class="p">(</span><span class="n">ex</span> <span class="kp">isa</span> <span class="kt">Expr</span> <span class="o">&amp;&amp;</span> <span class="n">ex</span><span class="o">.</span><span class="n">head</span> <span class="o">==</span> <span class="o">:</span><span class="n">incomplete</span><span class="p">)</span>
<span class="k">end</span>


<span class="n">sandbox_mode</span> <span class="o">=</span> <span class="n">initrepl</span><span class="p">(</span><span class="n">sandbox_parser</span><span class="p">;</span>
                        <span class="n">prompt_text</span><span class="o">=</span><span class="s">"Sandbox&gt; "</span><span class="p">,</span>
                        <span class="n">prompt_color</span> <span class="o">=</span> <span class="o">:</span><span class="n">yellow</span><span class="p">,</span>
                        <span class="n">startup_text</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
                        <span class="n">mode_name</span> <span class="o">=</span> <span class="o">:</span><span class="n">sandbox</span><span class="p">,</span>
                        <span class="n">valid_input_checker</span> <span class="o">=</span> <span class="n">valid_julia</span><span class="p">)</span>

<span class="n">enter_mode!</span><span class="p">(</span><span class="n">sandbox_mode</span><span class="p">)</span>
</code></pre></div>



<a name="228089202"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228089202" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228089202">(Feb 27 2021 at 23:07)</a>:</h4>
<p>I guess what I should actually do is just transparently rewrite symbols that match anything in Core. That would be quite simple.</p>



<a name="228093906"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228093906" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228093906">(Feb 28 2021 at 00:44)</a>:</h4>
<p>For posterity: I posted a better version <a href="https://discourse.julialang.org/t/even-more-bare-baremodule/56156/2">on discourse</a>.</p>



<a name="228145388"></a>
<h4><a href="https://julialang.zulipchat.com#narrow/stream/274208-helpdesk%20%28published%29/topic/Sandbox%20Julia%3F/near/228145388" class="zl"><img src="https://juliacommunity.github.io/zulip-archive/assets/img/zulip.svg" alt="view this post on Zulip" style="width:20px;height:20px;"></a> Colin Caine <a href="https://juliacommunity.github.io/zulip-archive/stream/274208-helpdesk-(published)/topic/Sandbox.20Julia.3F.html#228145388">(Feb 28 2021 at 17:49)</a>:</h4>
<p>I made a little package for fun <a href="https://github.com/cmcaine/Sandboxes.jl">https://github.com/cmcaine/Sandboxes.jl</a></p>



<hr><p>Last updated: Jun 27 2021 at 11:01 UTC</p>
</html>